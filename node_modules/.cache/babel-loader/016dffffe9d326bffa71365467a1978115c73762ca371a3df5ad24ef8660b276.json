{"ast":null,"code":"// src/pages/PatientTemplatesPage.js\nimport React,{useState,useEffect}from'react';import'../styles/routineTemplates.css';import{FaCheck,FaClock}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const[instances,setInstances]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Suponemos que al hacer login guardas { id, token } en localStorage bajo 'user'\nconst user=JSON.parse(localStorage.getItem('user')||'{}');const token=localStorage.getItem('token');useEffect(()=>{if(!token||!user.id){return window.location.replace('/login');}fetch(`/api/routines/instances/${user.id}`,{headers:{'x-auth-token':token}}).then(async res=>{if(!res.ok)throw new Error(`HTTP ${res.status}: ${await res.text()}`);return res.json();}).then(data=>setInstances(data)).catch(err=>setError(err.message)).finally(()=>setLoading(false));},[user.id,token]);const markDone=(instanceId,idx)=>{fetch(`/api/routines/instances/${instanceId}/activities/${idx}`,{method:'POST',headers:{'x-auth-token':token}}).then(async res=>{if(!res.ok)throw new Error(`HTTP ${res.status}`);// Refrescar estado local\nsetInstances(list=>list.map(inst=>{if(inst._id!==instanceId)return inst;const acts=[...inst.activities];acts[idx].completed=true;return{...inst,activities:acts};}));}).catch(console.error);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"patient-assigns\",children:\"Cargando tus rutinas\\u2026\"});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[\"Error: \",error]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas Asignadas\"}),instances.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"empty-state\",children:\"\\u23F3 A\\xFAn no tienes ninguna plantilla asignada\"}):instances.map(inst=>/*#__PURE__*/_jsxs(\"div\",{className:`assign-card ${inst.completedAt?'status-completed':''}`,children:[/*#__PURE__*/_jsx(\"h3\",{children:inst.template.name}),/*#__PURE__*/_jsxs(\"small\",{children:[\"Creada el \",new Date(inst.createdAt).toLocaleDateString()]}),/*#__PURE__*/_jsx(\"ul\",{children:inst.activities.map((act,idx)=>/*#__PURE__*/_jsxs(\"li\",{className:\"assign-actions\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[act.name,\" \\u2014 \",act.challenge,\" \\u2014 \",act.minutes,\" min\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-complete\",disabled:act.completed,onClick:()=>markDone(inst._id,idx),title:act.completed?'Completada':'Marcar como completada',children:act.completed?/*#__PURE__*/_jsx(FaCheck,{}):/*#__PURE__*/_jsx(FaClock,{})})]},idx))}),inst.completedAt&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'0.5rem',fontSize:'0.85rem',color:'#555'},children:[\"Completada el \",new Date(inst.completedAt).toLocaleString()]})]},inst._id))]});}","map":{"version":3,"names":["React","useState","useEffect","FaCheck","FaClock","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","instances","setInstances","loading","setLoading","error","setError","user","JSON","parse","localStorage","getItem","token","id","window","location","replace","fetch","headers","then","res","ok","Error","status","text","json","data","catch","err","message","finally","markDone","instanceId","idx","method","list","map","inst","_id","acts","activities","completed","console","className","children","length","completedAt","template","name","Date","createdAt","toLocaleDateString","act","challenge","minutes","disabled","onClick","title","style","marginTop","fontSize","color","toLocaleString"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/pages/PatientTemplatesPage.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport '../styles/routineTemplates.css';\r\nimport { FaCheck, FaClock } from 'react-icons/fa';\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const [instances, setInstances] = useState([]);\r\n  const [loading, setLoading]   = useState(true);\r\n  const [error, setError]       = useState(null);\r\n\r\n  // Suponemos que al hacer login guardas { id, token } en localStorage bajo 'user'\r\n  const user = JSON.parse(localStorage.getItem('user') || '{}');\r\n  const token = localStorage.getItem('token');\r\n\r\n  useEffect(() => {\r\n    if (!token || !user.id) {\r\n      return window.location.replace('/login');\r\n    }\r\n    fetch(`/api/routines/instances/${user.id}`, {\r\n      headers: { 'x-auth-token': token }\r\n    })\r\n      .then(async res => {\r\n        if (!res.ok) throw new Error(`HTTP ${res.status}: ${await res.text()}`);\r\n        return res.json();\r\n      })\r\n      .then(data => setInstances(data))\r\n      .catch(err => setError(err.message))\r\n      .finally(() => setLoading(false));\r\n  }, [user.id, token]);\r\n\r\n  const markDone = (instanceId, idx) => {\r\n    fetch(`/api/routines/instances/${instanceId}/activities/${idx}`, {\r\n      method: 'POST',\r\n      headers: { 'x-auth-token': token }\r\n    })\r\n      .then(async res => {\r\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n        // Refrescar estado local\r\n        setInstances(list => list.map(inst => {\r\n          if (inst._id !== instanceId) return inst;\r\n          const acts = [...inst.activities];\r\n          acts[idx].completed = true;\r\n          return { ...inst, activities: acts };\r\n        }));\r\n      })\r\n      .catch(console.error);\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"patient-assigns\">Cargando tus rutinas…</div>;\r\n  }\r\n  if (error) {\r\n    return <div className=\"patient-assigns\">Error: {error}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"patient-assigns\">\r\n      <h1>Mis Plantillas Asignadas</h1>\r\n\r\n      {instances.length === 0 ? (\r\n        <div className=\"empty-state\">\r\n          ⏳ Aún no tienes ninguna plantilla asignada\r\n        </div>\r\n      ) : (\r\n        instances.map(inst => (\r\n          <div\r\n            key={inst._id}\r\n            className={`assign-card ${\r\n              inst.completedAt ? 'status-completed' : ''\r\n            }`}\r\n          >\r\n            <h3>{inst.template.name}</h3>\r\n            <small>Creada el {new Date(inst.createdAt).toLocaleDateString()}</small>\r\n\r\n            <ul>\r\n              {inst.activities.map((act, idx) => (\r\n                <li key={idx} className=\"assign-actions\">\r\n                  <span>\r\n                    {act.name} — {act.challenge} — {act.minutes} min\r\n                  </span>\r\n                  <button\r\n                    className=\"btn-complete\"\r\n                    disabled={act.completed}\r\n                    onClick={() => markDone(inst._id, idx)}\r\n                    title={\r\n                      act.completed\r\n                        ? 'Completada'\r\n                        : 'Marcar como completada'\r\n                    }\r\n                  >\r\n                    {act.completed ? <FaCheck /> : <FaClock />}\r\n                  </button>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n\r\n            {inst.completedAt && (\r\n              <div style={{ marginTop: '0.5rem', fontSize: '0.85rem', color: '#555' }}>\r\n                Completada el {new Date(inst.completedAt).toLocaleString()}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ))\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}