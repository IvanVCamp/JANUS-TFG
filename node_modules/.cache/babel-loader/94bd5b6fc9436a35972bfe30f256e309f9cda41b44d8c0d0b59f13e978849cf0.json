{"ast":null,"code":"// src/components/PatientTemplatesPage.js\nimport React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import'../styles/routineTemplates.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const[instances,setInstances]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();useEffect(()=>{const token=localStorage.getItem('token');const user=JSON.parse(localStorage.getItem('user'));if(!token||!user){navigate('/login');return;}axios.get(`/api/routines/instances/${user.id}`,{headers:{'x-auth-token':token}}).then(res=>setInstances(res.data)).catch(err=>setError(err.message)).finally(()=>setLoading(false));},[navigate]);const markActivity=async(instanceId,idx,completed)=>{try{const token=localStorage.getItem('token');const res=await axios.post(`/api/routines/instances/${instanceId}/activities/${idx}`,{completed},{headers:{'x-auth-token':token}});setInstances(prev=>prev.map(inst=>inst._id===instanceId?{...inst,completedActivities:res.data.completedActivities}:inst));}catch(err){console.error(err);}};const updateStatus=async(instanceId,status)=>{try{const token=localStorage.getItem('token');const res=await axios.put(`/api/routines/instances/${instanceId}/status`,{status},{headers:{'x-auth-token':token}});setInstances(prev=>prev.map(inst=>inst._id===instanceId?{...inst,status:res.data.status}:inst));}catch(err){console.error(err);}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"patient-assigns\",children:\"Cargando mis plantillas\\u2026\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[\"Error: \",error]});return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas Asignadas\"}),instances.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"A\\xFAn no tienes plantillas asignadas.\"}),instances.map(inst=>{const completed=inst.completedActivities||[];const total=inst.template.activities.length;const doneCount=completed.length;const allDone=doneCount===total;return/*#__PURE__*/_jsxs(\"div\",{className:`assign-card ${inst.status?'status-'+inst.status:''}`,children:[/*#__PURE__*/_jsx(\"h3\",{children:inst.template.name}),inst.assignedAt&&/*#__PURE__*/_jsxs(\"small\",{children:[\"Asignada el \",new Date(inst.assignedAt).toLocaleDateString()]}),/*#__PURE__*/_jsx(\"p\",{children:inst.template.description}),/*#__PURE__*/_jsx(\"ul\",{children:inst.template.activities.map((act,idx)=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:completed.includes(idx),onChange:()=>markActivity(inst._id,idx,!completed.includes(idx))}),act.name,\" (\",act.minutes,\" min)\",act.challenge&&` - Reto: ${act.challenge}`]})},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"assign-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-complete\",onClick:()=>updateStatus(inst._id,'completed'),disabled:!allDone,children:\"Completar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-postpone\",onClick:()=>updateStatus(inst._id,'postponed'),disabled:allDone,children:\"Postergar\"})]})]},inst._id);})]});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","axios","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","instances","setInstances","loading","setLoading","error","setError","navigate","token","localStorage","getItem","user","JSON","parse","get","id","headers","then","res","data","catch","err","message","finally","markActivity","instanceId","idx","completed","post","prev","map","inst","_id","completedActivities","console","updateStatus","status","put","className","children","length","total","template","activities","doneCount","allDone","name","assignedAt","Date","toLocaleDateString","description","act","type","checked","includes","onChange","minutes","challenge","onClick","disabled"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/components/PatientTemplatesPage.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport '../styles/routineTemplates.css';\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const [instances, setInstances] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    const user = JSON.parse(localStorage.getItem('user'));\r\n    if (!token || !user) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n    axios.get(`/api/routines/instances/${user.id}`, {\r\n      headers: { 'x-auth-token': token }\r\n    })\r\n      .then(res => setInstances(res.data))\r\n      .catch(err => setError(err.message))\r\n      .finally(() => setLoading(false));\r\n  }, [navigate]);\r\n\r\n  const markActivity = async (instanceId, idx, completed) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const res = await axios.post(\r\n        `/api/routines/instances/${instanceId}/activities/${idx}`,\r\n        { completed },\r\n        { headers: { 'x-auth-token': token } }\r\n      );\r\n      setInstances(prev =>\r\n        prev.map(inst =>\r\n          inst._id === instanceId\r\n            ? { ...inst, completedActivities: res.data.completedActivities }\r\n            : inst\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  const updateStatus = async (instanceId, status) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const res = await axios.put(\r\n        `/api/routines/instances/${instanceId}/status`,\r\n        { status },\r\n        { headers: { 'x-auth-token': token } }\r\n      );\r\n      setInstances(prev =>\r\n        prev.map(inst =>\r\n          inst._id === instanceId ? { ...inst, status: res.data.status } : inst\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"patient-assigns\">Cargando mis plantillas…</div>;\r\n  if (error) return <div className=\"patient-assigns\">Error: {error}</div>;\r\n\r\n  return (\r\n    <div className=\"patient-assigns\">\r\n      <h1>Mis Plantillas Asignadas</h1>\r\n      {instances.length === 0 && <p>Aún no tienes plantillas asignadas.</p>}\r\n      {instances.map(inst => {\r\n        const completed = inst.completedActivities || [];\r\n        const total = inst.template.activities.length;\r\n        const doneCount = completed.length;\r\n        const allDone = doneCount === total;\r\n        return (\r\n          <div\r\n            key={inst._id}\r\n            className={`assign-card ${inst.status ? 'status-' + inst.status : ''}`}\r\n          >\r\n            <h3>{inst.template.name}</h3>\r\n            {inst.assignedAt && (\r\n              <small>Asignada el {new Date(inst.assignedAt).toLocaleDateString()}</small>\r\n            )}\r\n            <p>{inst.template.description}</p>\r\n            <ul>\r\n              {inst.template.activities.map((act, idx) => (\r\n                <li key={idx}>\r\n                  <label>\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={completed.includes(idx)}\r\n                      onChange={() =>\r\n                        markActivity(inst._id, idx, !completed.includes(idx))\r\n                      }\r\n                    />\r\n                    {act.name} ({act.minutes} min){act.challenge && ` - Reto: ${act.challenge}`}\r\n                  </label>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n            <div className=\"assign-actions\">\r\n              <button\r\n                className=\"btn-complete\"\r\n                onClick={() => updateStatus(inst._id, 'completed')}\r\n                disabled={!allDone}\r\n              >\r\n                Completar\r\n              </button>\r\n              <button\r\n                className=\"btn-postpone\"\r\n                onClick={() => updateStatus(inst._id, 'postponed')}\r\n                disabled={allDone}\r\n              >\r\n                Postergar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}