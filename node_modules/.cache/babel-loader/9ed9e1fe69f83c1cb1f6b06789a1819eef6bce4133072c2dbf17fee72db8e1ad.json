{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useParams,Link}from'react-router-dom';import'../styles/routineTemplates.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function TherapistPatientTemplatesDetail(){const{patientId}=useParams();const[instances,setInstances]=useState([]);const[patient,setPatient]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchDetail=async()=>{try{const token=localStorage.getItem('token');// 1. Obtener datos del paciente (para mostrar nombre completo)\nconst{data:allPatients}=await axios.get('/api/therapist/patients',{headers:{'x-auth-token':token}});setPatient(allPatients.find(p=>p._id===patientId));// 2. Obtener todas sus instancias de plantilla\nconst{data}=await axios.get(`/api/routines/instances/${patientId}`,{headers:{'x-auth-token':token}});setInstances(data);}catch(err){console.error(err);setError('Error cargando detalles');}finally{setLoading(false);}};fetchDetail();},[patientId]);if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando detalles\\u2026\"});if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-container detail-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/templates\",className:\"back-link\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Plantillas de \",patient===null||patient===void 0?void 0:patient.nombre,\" \",patient===null||patient===void 0?void 0:patient.apellidos]})]}),instances.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay plantillas asignadas.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"tpl-grid\",children:instances.map(inst=>{var _tpl$tags;const tpl=inst.template;const total=tpl.activities.length;const done=inst.completedActivities.length;const pct=Math.round(done/total*100);return/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-card detail-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:tpl.name})}),/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-filled\",style:{width:`${pct}%`},\"aria-label\":`${pct}% completado`})}),/*#__PURE__*/_jsxs(\"p\",{className:\"progress-text\",children:[done,\" de \",total,\" actividades completadas (\",pct,\"%)\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"tags-container\",children:(_tpl$tags=tpl.tags)===null||_tpl$tags===void 0?void 0:_tpl$tags.map(tag=>/*#__PURE__*/_jsx(\"span\",{className:\"tag-badge\",children:tag},tag))}),/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-meta detail-meta\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-calendar\"}),\" Asignado: \",new Date(inst.createdAt).toLocaleDateString()]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-refresh\"}),\" \\xDAltima actualizaci\\xF3n: \",new Date(inst.updatedAt||inst.createdAt).toLocaleString()]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-clock-o\"}),\" Duraci\\xF3n: \",tpl.duration,\" min\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-flag\"}),\" Reto nivel \",tpl.challengeLevel]})]}),/*#__PURE__*/_jsx(\"ul\",{className:\"activities-detailed-list\",children:tpl.activities.map((act,i)=>{const completed=inst.completedActivities.includes(i);return/*#__PURE__*/_jsxs(\"li\",{className:`activity-detail-item ${completed?'completed':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"activity-main\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"checkbox-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:completed,readOnly:true}),/*#__PURE__*/_jsx(\"span\",{className:\"activity-name\",children:act.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-info-icons\",children:[/*#__PURE__*/_jsxs(\"span\",{title:\"Duraci\\xF3n\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-clock-o\"}),\" \",act.minutes,\" min\"]}),/*#__PURE__*/_jsxs(\"span\",{title:\"Nivel de reto\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-star\"}),\" \",act.challenge]})]})]}),act.desc&&/*#__PURE__*/_jsx(\"p\",{className:\"activity-desc\",children:act.desc})]},i);})})]},inst._id);})})]});}","map":{"version":3,"names":["React","useState","useEffect","axios","useParams","Link","jsx","_jsx","jsxs","_jsxs","TherapistPatientTemplatesDetail","patientId","instances","setInstances","patient","setPatient","loading","setLoading","error","setError","fetchDetail","token","localStorage","getItem","data","allPatients","get","headers","find","p","_id","err","console","children","className","to","nombre","apellidos","length","map","inst","_tpl$tags","tpl","template","total","activities","done","completedActivities","pct","Math","round","name","style","width","tags","tag","Date","createdAt","toLocaleDateString","updatedAt","toLocaleString","duration","challengeLevel","act","i","completed","includes","type","checked","readOnly","title","minutes","challenge","desc"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/TherapistTemplatesDetail.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport '../styles/routineTemplates.css';\r\n\r\nexport default function TherapistPatientTemplatesDetail() {\r\n  const { patientId } = useParams();\r\n  const [instances, setInstances] = useState([]);\r\n  const [patient, setPatient]     = useState(null);\r\n  const [loading, setLoading]     = useState(true);\r\n  const [error, setError]         = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchDetail = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        // 1. Obtener datos del paciente (para mostrar nombre completo)\r\n        const { data: allPatients } = await axios.get(\r\n          '/api/therapist/patients',\r\n          { headers: { 'x-auth-token': token } }\r\n        );\r\n        setPatient(allPatients.find(p => p._id === patientId));\r\n\r\n        // 2. Obtener todas sus instancias de plantilla\r\n        const { data } = await axios.get(\r\n          `/api/routines/instances/${patientId}`,\r\n          { headers: { 'x-auth-token': token } }\r\n        );\r\n        setInstances(data);\r\n\r\n      } catch (err) {\r\n        console.error(err);\r\n        setError('Error cargando detalles');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDetail();\r\n  }, [patientId]);\r\n\r\n  if (loading) return <p>Cargando detalles…</p>;\r\n  if (error)   return <p className=\"error-msg\">{error}</p>;\r\n\r\n  return (\r\n    <div className=\"tpl-container detail-container\">\r\n      <div className=\"detail-header\">\r\n        <Link to=\"/therapist/templates\" className=\"back-link\">← Volver</Link>\r\n        <h1>Plantillas de {patient?.nombre} {patient?.apellidos}</h1>\r\n      </div>\r\n\r\n      {instances.length === 0\r\n        ? <p>No hay plantillas asignadas.</p>\r\n        : (\r\n          <div className=\"tpl-grid\">\r\n            {instances.map(inst => {\r\n              const tpl   = inst.template;\r\n              const total = tpl.activities.length;\r\n              const done  = inst.completedActivities.length;\r\n              const pct   = Math.round((done/total)*100);\r\n\r\n              return (\r\n                <div key={inst._id} className=\"tpl-card detail-card\">\r\n                  <div className=\"detail-header\">\r\n                    <h2>{tpl.name}</h2>\r\n                  </div>\r\n\r\n                  <div className=\"progress-bar\">\r\n                    <div\r\n                      className=\"progress-filled\"\r\n                      style={{ width: `${pct}%` }}\r\n                      aria-label={`${pct}% completado`}\r\n                    />\r\n                  </div>\r\n                  <p className=\"progress-text\">\r\n                    {done} de {total} actividades completadas ({pct}%)\r\n                  </p>\r\n\r\n                  <div className=\"tags-container\">\r\n                    {tpl.tags?.map(tag => (\r\n                      <span key={tag} className=\"tag-badge\">{tag}</span>\r\n                    ))}\r\n                  </div>\r\n\r\n                  <div className=\"tpl-meta detail-meta\">\r\n                    <div><i className=\"fa fa-calendar\"></i> Asignado: {new Date(inst.createdAt).toLocaleDateString()}</div>\r\n                    <div><i className=\"fa fa-refresh\"></i> Última actualización: {new Date(inst.updatedAt||inst.createdAt).toLocaleString()}</div>\r\n                    <div><i className=\"fa fa-clock-o\"></i> Duración: {tpl.duration} min</div>\r\n                    <div><i className=\"fa fa-flag\"></i> Reto nivel {tpl.challengeLevel}</div>\r\n                  </div>\r\n\r\n                  <ul className=\"activities-detailed-list\">\r\n                    {tpl.activities.map((act, i) => {\r\n                      const completed = inst.completedActivities.includes(i);\r\n                      return (\r\n                        <li key={i} className={`activity-detail-item ${completed ? 'completed' : ''}`}>\r\n                          <div className=\"activity-main\">\r\n                            <label className=\"checkbox-label\">\r\n                              <input type=\"checkbox\" checked={completed} readOnly />\r\n                              <span className=\"activity-name\">{act.name}</span>\r\n                            </label>\r\n                            <div className=\"activity-info-icons\">\r\n                              <span title=\"Duración\"><i className=\"fa fa-clock-o\"></i> {act.minutes} min</span>\r\n                              <span title=\"Nivel de reto\"><i className=\"fa fa-star\"></i> {act.challenge}</span>\r\n                            </div>\r\n                          </div>\r\n                          {act.desc && <p className=\"activity-desc\">{act.desc}</p>}\r\n                        </li>\r\n                      );\r\n                    })}\r\n                  </ul>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )\r\n      }\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}