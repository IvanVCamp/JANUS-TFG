{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,Link}from'react-router-dom';import axios from'axios';import{PieChart,Pie,Cell,Tooltip as PieTooltip,Legend as PieLegend,BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip as BarTooltip,LineChart,Line,RadarChart,PolarGrid,PolarAngleAxis,PolarRadiusAxis,Radar,ResponsiveContainer}from'recharts';import'../styles/therapistRoutines.css';// Mapeo de actividad a categoría\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const categoryMap={futbol:'Ocio',dibujos:'Ocio',comics:'Ocio',tarea:'Obligaciones',videojuegos:'Ocio',helado:'Ocio',parque:'Ocio',banio:'Autocuidado',dormir:'Autocuidado',musica:'Ocio',bailar:'Ocio',amigos:'Ocio',bicicleta:'Ocio',dibujar:'Ocio',mascotas:'Ocio',experimentos:'Obligaciones',cantar:'Ocio',lego:'Ocio',nadar:'Autocuidado',computadora:'Ocio'};// Mapeo de categoría a grupo para radar\nconst groupMap={Autocuidado:'Autocuidado',Obligaciones:'Obligaciones',Ocio:'Ocio'};// Colores\nconst COLORS=['#8884d8','#82ca9d','#ffc658','#ff8042','#0088FE'];function PatientRoutines(){const{patientId}=useParams();const[results,setResults]=useState([]);const[filtered,setFiltered]=useState([]);const[from,setFrom]=useState('');const[to,setTo]=useState('');const[selected,setSelected]=useState(null);const[metrics,setMetrics]=useState(null);// 1) Cargar resultados de la Máquina del Tiempo\nuseEffect(()=>{const token=localStorage.getItem('token');axios.get(`http://localhost:8080/api/game?patientId=${patientId}`,{headers:{'x-auth-token':token}}).then(resp=>{const data=resp.data;setResults(data);// filtro inicial: últimos 7 días\nconst now=new Date();const weekAgo=new Date(now);weekAgo.setDate(now.getDate()-6);setFrom(weekAgo.toISOString().slice(0,10));setTo(now.toISOString().slice(0,10));}).catch(console.error);},[patientId]);// 2) Filtrar por rango de fechas\nuseEffect(()=>{if(!from||!to)return;const fDate=new Date(from);const tDate=new Date(to);tDate.setHours(23,59,59,999);const arr=results.filter(r=>{const d=new Date(r.createdAt);return d>=fDate&&d<=tDate;});setFiltered(arr);},[results,from,to]);// 3) Poner seleccionado el primer filtrado\nuseEffect(()=>{if(filtered.length)setSelected(filtered[0].createdAt);else setSelected(null);},[filtered]);// 4) Calcular métricas cuando cambia el seleccionado\nuseEffect(()=>{if(!selected)return;const res=filtered.find(r=>r.createdAt===selected);if(!res)return setMetrics(null);setMetrics(computeMetrics(res,filtered));},[selected,filtered]);// Función computeMetrics\nfunction computeMetrics(result,allResults){// Aplanar actividades del día seleccionado\nconst slots=result.timeSlots||[];const activities=slots.flatMap(s=>(s.activities||[]).map(a=>({...a,slot:s.slot})));const totalMin=activities.reduce((sum,a)=>sum+a.duration,0);// 1. Distribución % por categoría\nconst catSum={};activities.forEach(a=>{const c=categoryMap[a.activityId]||'Otros';catSum[c]=(catSum[c]||0)+a.duration;});const distribution=Object.entries(catSum).map(_ref=>{let[name,val]=_ref;return{name,value:+(val/totalMin*100).toFixed(1)};});// 2. Promedio diario por categoría (horas)\nconst days=allResults.length||1;const averageDaily=Object.entries(catSum).map(_ref2=>{let[name,val]=_ref2;return{name,avgHours:+(val/days/60).toFixed(2)};});// 3. Tendencia temporal (% por grupo por día)\nconst trend=allResults.map(r=>{const acts=(r.timeSlots||[]).flatMap(s=>s.activities.map(a=>({...a,slot:s.slot})));const tot=acts.reduce((s,a)=>s+a.duration,0)||1;const sums={Autocuidado:0,Obligaciones:0,Ocio:0};acts.forEach(a=>{const cat=categoryMap[a.activityId]||'Ocio';sums[groupMap[cat]]+=a.duration;});return{date:new Date(r.createdAt).toLocaleDateString(),Autocuidado:+(sums.Autocuidado/tot*100).toFixed(1),Obligaciones:+(sums.Obligaciones/tot*100).toFixed(1),Ocio:+(sums.Ocio/tot*100).toFixed(1)};});// 4. Variabilidad (desviación estándar diaria por categoría en minutos)\nconst dailyCatSums=allResults.map(r=>{const tmp={};(r.timeSlots||[]).forEach(s=>{(s.activities||[]).forEach(a=>{const c=categoryMap[a.activityId]||'Otros';tmp[c]=(tmp[c]||0)+a.duration;});});return tmp;});const variability=[];for(let cat in catSum){const avg=catSum[cat]/days;const variance=dailyCatSums.reduce((acc,d)=>acc+Math.pow((d[cat]||0)-avg,2),0)/days;variability.push({name:cat,stdDev:+Math.sqrt(variance).toFixed(1)});}// 5. Índice de equilibrio ocio/obligaciones\nconst ocio=catSum['Ocio']||0;const obr=catSum['Obligaciones']||0.1;const balanceRatio=+(ocio/obr).toFixed(2);// 6. Horas ocupadas vs libres (selected day)\nconst occupied=totalMin;const free=24*60-occupied;const occFree=[{name:'Ocupado',value:occupied},{name:'Libre',value:free}];// 7. Diversidad de actividades\nconst diversity=new Set(activities.map(a=>a.activityId)).size;// 8. Patrón horario (sumas por hora)\nconst hourMap={};slots.forEach(s=>{const h=parseInt(s.slot.split(':')[0],10);s.activities.forEach(a=>{hourMap[h]=(hourMap[h]||0)+a.duration;});});// convert to array 0..23\nconst patternHourly=Array.from({length:24},(_,i)=>({hour:`${String(i).padStart(2,'0')}:00`,minutes:hourMap[i]||0}));// 9. Cumplimiento de rutina (% slots con ≥1 actividad)\nconst coveredSlots=slots.filter(s=>(s.activities||[]).length>0).length;const compliance=+(coveredSlots/24*100).toFixed(1);// 10. Bloques prolongados ≥120min\nconst segments=[];let seg=null;for(let i=0;i<24;i++){const m=hourMap[i]||0;if(m>0){if(seg){seg.end=i;seg.duration+=m;}else{seg={start:i,end:i,duration:m};}}else{if(seg){if(seg.duration>=120)segments.push(seg);seg=null;}}}if(seg&&seg.duration>=120)segments.push(seg);const prolongedBlocks=segments.map(s=>({start:`${String(s.start).padStart(2,'0')}:00`,end:`${String(s.end).padStart(2,'0')}:59`,duration:s.duration}));return{distribution,averageDaily,trend,variability,balanceRatio,occFree,diversity,patternHourly,compliance,prolongedBlocks};}return/*#__PURE__*/_jsxs(\"div\",{className:\"routines-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"routines-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/routines\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Rutinas de Paciente\"})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"filter-section\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Desde:\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:from,onChange:e=>setFrom(e.target.value)})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Hasta:\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:to,onChange:e=>setTo(e.target.value)})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"D\\xEDa:\",/*#__PURE__*/_jsx(\"select\",{value:selected||'',onChange:e=>setSelected(e.target.value),children:filtered.map(r=>/*#__PURE__*/_jsx(\"option\",{value:r.createdAt,children:new Date(r.createdAt).toLocaleDateString()},r.createdAt))})]})]}),metrics&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metrics-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metric-card\",children:[\"Diversidad: \",/*#__PURE__*/_jsx(\"strong\",{children:metrics.diversity})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric-card\",children:[\"Consistencia: \",/*#__PURE__*/_jsxs(\"strong\",{children:[metrics.compliance,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric-card\",children:[\"\\xCDndice Ocio/Oblig: \",/*#__PURE__*/_jsx(\"strong\",{children:metrics.balanceRatio})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"charts-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Distribuci\\xF3n % por Categor\\xEDa\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(PieChart,{children:[/*#__PURE__*/_jsx(Pie,{data:metrics.distribution,dataKey:\"value\",nameKey:\"name\",cx:\"50%\",cy:\"50%\",outerRadius:60,label:true,children:metrics.distribution.map((_,i)=>/*#__PURE__*/_jsx(Cell,{fill:COLORS[i%COLORS.length]},i))}),/*#__PURE__*/_jsx(PieTooltip,{}),/*#__PURE__*/_jsx(PieLegend,{})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Promedio Diario (h)\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(BarChart,{data:metrics.averageDaily,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"name\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(BarTooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"avgHours\",fill:\"#82ca9d\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Variabilidad (std dev min)\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(BarChart,{data:metrics.variability,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"name\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(BarTooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"stdDev\",fill:\"#ff8042\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Horas Ocupado vs Libre\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(PieChart,{children:[/*#__PURE__*/_jsx(Pie,{data:metrics.occFree,dataKey:\"value\",nameKey:\"name\",cx:\"50%\",cy:\"50%\",innerRadius:30,outerRadius:60,label:true,children:metrics.occFree.map((_,i)=>/*#__PURE__*/_jsx(Cell,{fill:COLORS[(i+1)%COLORS.length]},i))}),/*#__PURE__*/_jsx(PieTooltip,{})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Balance Grupal (%)\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:200,children:/*#__PURE__*/_jsxs(RadarChart,{data:metrics.trend[0]/* dummy, no usar */,children:[/*#__PURE__*/_jsx(PolarGrid,{}),/*#__PURE__*/_jsx(PolarAngleAxis,{}),/*#__PURE__*/_jsx(PolarRadiusAxis,{})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block full-width\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Tendencia Semanal (%)\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:250,children:/*#__PURE__*/_jsxs(LineChart,{data:metrics.trend,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(BarTooltip,{}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"Autocuidado\",stroke:\"#8884d8\"}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"Obligaciones\",stroke:\"#82ca9d\"}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"Ocio\",stroke:\"#ffc658\"}),/*#__PURE__*/_jsx(PieLegend,{})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block full-width\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Patr\\xF3n Horario (min por hora)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"heatmap\",children:metrics.patternHourly.map((h,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"heatmap-cell\",style:{background:`rgba(124,99,246,${h.minutes/Math.max(...metrics.patternHourly.map(x=>x.minutes||1))})`},title:`${h.hour}: ${h.minutes} min`,children:h.hour},i))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block full-width\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Bloques Prolongados (\\u22652h)\"}),metrics.prolongedBlocks.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay bloques prolongados.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"blocks-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Inicio\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Fin\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Duraci\\xF3n (min)\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:metrics.prolongedBlocks.map((b,i)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:b.start}),/*#__PURE__*/_jsx(\"td\",{children:b.end}),/*#__PURE__*/_jsx(\"td\",{children:b.duration})]},i))})]})]})]})]})]});}export default PatientRoutines;","map":{"version":3,"names":["React","useState","useEffect","useParams","Link","axios","PieChart","Pie","Cell","Tooltip","PieTooltip","Legend","PieLegend","BarChart","Bar","XAxis","YAxis","CartesianGrid","BarTooltip","LineChart","Line","RadarChart","PolarGrid","PolarAngleAxis","PolarRadiusAxis","Radar","ResponsiveContainer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","categoryMap","futbol","dibujos","comics","tarea","videojuegos","helado","parque","banio","dormir","musica","bailar","amigos","bicicleta","dibujar","mascotas","experimentos","cantar","lego","nadar","computadora","groupMap","Autocuidado","Obligaciones","Ocio","COLORS","PatientRoutines","patientId","results","setResults","filtered","setFiltered","from","setFrom","to","setTo","selected","setSelected","metrics","setMetrics","token","localStorage","getItem","get","headers","then","resp","data","now","Date","weekAgo","setDate","getDate","toISOString","slice","catch","console","error","fDate","tDate","setHours","arr","filter","r","d","createdAt","length","res","find","computeMetrics","result","allResults","slots","timeSlots","activities","flatMap","s","map","a","slot","totalMin","reduce","sum","duration","catSum","forEach","c","activityId","distribution","Object","entries","_ref","name","val","value","toFixed","days","averageDaily","_ref2","avgHours","trend","acts","tot","sums","cat","date","toLocaleDateString","dailyCatSums","tmp","variability","avg","variance","acc","Math","pow","push","stdDev","sqrt","ocio","obr","balanceRatio","occupied","free","occFree","diversity","Set","size","hourMap","h","parseInt","split","patternHourly","Array","_","i","hour","String","padStart","minutes","coveredSlots","compliance","segments","seg","m","end","start","prolongedBlocks","className","children","type","onChange","e","target","width","height","dataKey","nameKey","cx","cy","outerRadius","label","fill","strokeDasharray","innerRadius","stroke","style","background","max","x","title","b"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientRoutines.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport {\r\n  PieChart, Pie, Cell, Tooltip as PieTooltip, Legend as PieLegend,\r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip as BarTooltip,\r\n  LineChart, Line, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar,\r\n  ResponsiveContainer\r\n} from 'recharts';\r\nimport '../styles/therapistRoutines.css';\r\n\r\n// Mapeo de actividad a categoría\r\nconst categoryMap = {\r\n  futbol: 'Ocio', dibujos: 'Ocio', comics: 'Ocio',\r\n  tarea: 'Obligaciones', videojuegos: 'Ocio', helado: 'Ocio',\r\n  parque: 'Ocio', banio: 'Autocuidado', dormir: 'Autocuidado',\r\n  musica: 'Ocio', bailar: 'Ocio', amigos: 'Ocio',\r\n  bicicleta: 'Ocio', dibujar: 'Ocio', mascotas: 'Ocio',\r\n  experimentos: 'Obligaciones', cantar: 'Ocio', lego: 'Ocio',\r\n  nadar: 'Autocuidado', computadora: 'Ocio'\r\n};\r\n// Mapeo de categoría a grupo para radar\r\nconst groupMap = {\r\n  Autocuidado: 'Autocuidado',\r\n  Obligaciones: 'Obligaciones',\r\n  Ocio: 'Ocio'\r\n};\r\n// Colores\r\nconst COLORS = ['#8884d8', '#82ca9d', '#ffc658', '#ff8042', '#0088FE'];\r\n\r\nfunction PatientRoutines() {\r\n  const { patientId } = useParams();\r\n  const [results, setResults] = useState([]);\r\n  const [filtered, setFiltered] = useState([]);\r\n  const [from, setFrom] = useState('');\r\n  const [to, setTo] = useState('');\r\n  const [selected, setSelected] = useState(null);\r\n  const [metrics, setMetrics] = useState(null);\r\n\r\n  // 1) Cargar resultados de la Máquina del Tiempo\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    axios.get(`http://localhost:8080/api/game?patientId=${patientId}`, {\r\n      headers: { 'x-auth-token': token }\r\n    })\r\n    .then(resp => {\r\n      const data = resp.data;\r\n      setResults(data);\r\n      // filtro inicial: últimos 7 días\r\n      const now = new Date();\r\n      const weekAgo = new Date(now);\r\n      weekAgo.setDate(now.getDate() - 6);\r\n      setFrom(weekAgo.toISOString().slice(0,10));\r\n      setTo(now.toISOString().slice(0,10));\r\n    })\r\n    .catch(console.error);\r\n  }, [patientId]);\r\n\r\n  // 2) Filtrar por rango de fechas\r\n  useEffect(() => {\r\n    if (!from || !to) return;\r\n    const fDate = new Date(from);\r\n    const tDate = new Date(to);\r\n    tDate.setHours(23,59,59,999);\r\n    const arr = results.filter(r => {\r\n      const d = new Date(r.createdAt);\r\n      return d >= fDate && d <= tDate;\r\n    });\r\n    setFiltered(arr);\r\n  }, [results, from, to]);\r\n\r\n  // 3) Poner seleccionado el primer filtrado\r\n  useEffect(() => {\r\n    if (filtered.length) setSelected(filtered[0].createdAt);\r\n    else setSelected(null);\r\n  }, [filtered]);\r\n\r\n  // 4) Calcular métricas cuando cambia el seleccionado\r\n  useEffect(() => {\r\n    if (!selected) return;\r\n    const res = filtered.find(r => r.createdAt === selected);\r\n    if (!res) return setMetrics(null);\r\n    setMetrics(computeMetrics(res, filtered));\r\n  }, [selected, filtered]);\r\n\r\n  // Función computeMetrics\r\n  function computeMetrics(result, allResults) {\r\n    // Aplanar actividades del día seleccionado\r\n    const slots = result.timeSlots || [];\r\n    const activities = slots.flatMap(s => (s.activities || []).map(a => ({ ...a, slot: s.slot })));\r\n    const totalMin = activities.reduce((sum,a) => sum + a.duration, 0);\r\n\r\n    // 1. Distribución % por categoría\r\n    const catSum = {};\r\n    activities.forEach(a => {\r\n      const c = categoryMap[a.activityId] || 'Otros';\r\n      catSum[c] = (catSum[c]||0) + a.duration;\r\n    });\r\n    const distribution = Object.entries(catSum).map(([name,val]) => ({\r\n      name,\r\n      value: +((val/totalMin)*100).toFixed(1)\r\n    }));\r\n\r\n    // 2. Promedio diario por categoría (horas)\r\n    const days = allResults.length || 1;\r\n    const averageDaily = Object.entries(catSum).map(([name,val]) => ({\r\n      name,\r\n      avgHours: +(val/days/60).toFixed(2)\r\n    }));\r\n\r\n    // 3. Tendencia temporal (% por grupo por día)\r\n    const trend = allResults.map(r => {\r\n      const acts = (r.timeSlots||[]).flatMap(s => s.activities.map(a => ({ ...a, slot: s.slot })));\r\n      const tot = acts.reduce((s,a)=>s+a.duration,0) || 1;\r\n      const sums = { Autocuidado:0, Obligaciones:0, Ocio:0 };\r\n      acts.forEach(a => {\r\n        const cat = categoryMap[a.activityId] || 'Ocio';\r\n        sums[groupMap[cat]] += a.duration;\r\n      });\r\n      return {\r\n        date: new Date(r.createdAt).toLocaleDateString(),\r\n        Autocuidado: +((sums.Autocuidado/tot)*100).toFixed(1),\r\n        Obligaciones: +((sums.Obligaciones/tot)*100).toFixed(1),\r\n        Ocio: +((sums.Ocio/tot)*100).toFixed(1)\r\n      };\r\n    });\r\n\r\n    // 4. Variabilidad (desviación estándar diaria por categoría en minutos)\r\n    const dailyCatSums = allResults.map(r => {\r\n      const tmp = {};\r\n      (r.timeSlots||[]).forEach(s => {\r\n        (s.activities||[]).forEach(a => {\r\n          const c = categoryMap[a.activityId] || 'Otros';\r\n          tmp[c] = (tmp[c]||0) + a.duration;\r\n        });\r\n      });\r\n      return tmp;\r\n    });\r\n    const variability = [];\r\n    for (let cat in catSum) {\r\n      const avg = catSum[cat]/days;\r\n      const variance = dailyCatSums.reduce((acc,d) => acc + Math.pow((d[cat]||0)-avg,2), 0)/days;\r\n      variability.push({ name: cat, stdDev: +Math.sqrt(variance).toFixed(1) });\r\n    }\r\n\r\n    // 5. Índice de equilibrio ocio/obligaciones\r\n    const ocio = catSum['Ocio']||0;\r\n    const obr = catSum['Obligaciones']||0.1;\r\n    const balanceRatio = +(ocio/obr).toFixed(2);\r\n\r\n    // 6. Horas ocupadas vs libres (selected day)\r\n    const occupied = totalMin;\r\n    const free = 24*60 - occupied;\r\n    const occFree = [\r\n      { name:'Ocupado', value: occupied },\r\n      { name:'Libre', value: free }\r\n    ];\r\n\r\n    // 7. Diversidad de actividades\r\n    const diversity = new Set(activities.map(a=>a.activityId)).size;\r\n\r\n    // 8. Patrón horario (sumas por hora)\r\n    const hourMap = {};\r\n    slots.forEach(s => {\r\n      const h = parseInt(s.slot.split(':')[0],10);\r\n      s.activities.forEach(a => {\r\n        hourMap[h] = (hourMap[h]||0) + a.duration;\r\n      });\r\n    });\r\n    // convert to array 0..23\r\n    const patternHourly = Array.from({length:24},(_,i)=>({\r\n      hour:`${String(i).padStart(2,'0')}:00`,\r\n      minutes: hourMap[i]||0\r\n    }));\r\n\r\n    // 9. Cumplimiento de rutina (% slots con ≥1 actividad)\r\n    const coveredSlots = slots.filter(s=> (s.activities||[]).length>0 ).length;\r\n    const compliance = +((coveredSlots/24)*100).toFixed(1);\r\n\r\n    // 10. Bloques prolongados ≥120min\r\n    const segments = [];\r\n    let seg = null;\r\n    for (let i=0;i<24;i++) {\r\n      const m = hourMap[i]||0;\r\n      if (m>0) {\r\n        if (seg) {\r\n          seg.end = i; seg.duration += m;\r\n        } else {\r\n          seg = { start:i, end:i, duration:m };\r\n        }\r\n      } else {\r\n        if (seg) {\r\n          if (seg.duration>=120) segments.push(seg);\r\n          seg=null;\r\n        }\r\n      }\r\n    }\r\n    if (seg && seg.duration>=120) segments.push(seg);\r\n    const prolongedBlocks = segments.map(s=>({\r\n      start:`${String(s.start).padStart(2,'0')}:00`,\r\n      end:`${String(s.end).padStart(2,'0')}:59`,\r\n      duration:s.duration\r\n    }));\r\n\r\n    return {\r\n      distribution, averageDaily, trend, variability,\r\n      balanceRatio, occFree, diversity, patternHourly,\r\n      compliance, prolongedBlocks\r\n    };\r\n  }\r\n\r\n  return (\r\n    <div className=\"routines-container\">\r\n      <header className=\"routines-header\">\r\n        <Link to=\"/therapist/routines\">← Volver</Link>\r\n        <h2>Rutinas de Paciente</h2>\r\n      </header>\r\n\r\n      <section className=\"filter-section\">\r\n        <label>Desde:\r\n          <input type=\"date\" value={from} onChange={e=>setFrom(e.target.value)} />\r\n        </label>\r\n        <label>Hasta:\r\n          <input type=\"date\" value={to} onChange={e=>setTo(e.target.value)} />\r\n        </label>\r\n        <label>Día:\r\n          <select value={selected||''} onChange={e=>setSelected(e.target.value)}>\r\n            {filtered.map(r => (\r\n              <option key={r.createdAt} value={r.createdAt}>\r\n                {new Date(r.createdAt).toLocaleDateString()}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </label>\r\n      </section>\r\n\r\n      {metrics && (\r\n        <>\r\n          <div className=\"metrics-grid\">\r\n            <div className=\"metric-card\">Diversidad: <strong>{metrics.diversity}</strong></div>\r\n            <div className=\"metric-card\">Consistencia: <strong>{metrics.compliance}%</strong></div>\r\n            <div className=\"metric-card\">Índice Ocio/Oblig: <strong>{metrics.balanceRatio}</strong></div>\r\n          </div>\r\n\r\n          <div className=\"charts-grid\">\r\n            {/* Distribución % */}\r\n            <div className=\"chart-block\">\r\n              <h3>Distribución % por Categoría</h3>\r\n              <ResponsiveContainer width=\"100%\" height={200}>\r\n                <PieChart>\r\n                  <Pie\r\n                    data={metrics.distribution}\r\n                    dataKey=\"value\"\r\n                    nameKey=\"name\"\r\n                    cx=\"50%\"\r\n                    cy=\"50%\"\r\n                    outerRadius={60}\r\n                    label\r\n                  >\r\n                    {metrics.distribution.map((_, i)=>(\r\n                      <Cell key={i} fill={COLORS[i%COLORS.length]} />\r\n                    ))}\r\n                  </Pie>\r\n                  <PieTooltip />\r\n                  <PieLegend />\r\n                </PieChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Promedio diario */}\r\n            <div className=\"chart-block\">\r\n              <h3>Promedio Diario (h)</h3>\r\n              <ResponsiveContainer width=\"100%\" height={200}>\r\n                <BarChart data={metrics.averageDaily}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\"/>\r\n                  <XAxis dataKey=\"name\"/>\r\n                  <YAxis/>\r\n                  <BarTooltip/>\r\n                  <Bar dataKey=\"avgHours\" fill=\"#82ca9d\"/>\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Variabilidad */}\r\n            <div className=\"chart-block\">\r\n              <h3>Variabilidad (std dev min)</h3>\r\n              <ResponsiveContainer width=\"100%\" height={200}>\r\n                <BarChart data={metrics.variability}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\"/>\r\n                  <XAxis dataKey=\"name\"/>\r\n                  <YAxis/>\r\n                  <BarTooltip/>\r\n                  <Bar dataKey=\"stdDev\" fill=\"#ff8042\"/>\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Ocupado vs Libre */}\r\n            <div className=\"chart-block\">\r\n              <h3>Horas Ocupado vs Libre</h3>\r\n              <ResponsiveContainer width=\"100%\" height={200}>\r\n                <PieChart>\r\n                  <Pie\r\n                    data={metrics.occFree}\r\n                    dataKey=\"value\"\r\n                    nameKey=\"name\"\r\n                    cx=\"50%\"\r\n                    cy=\"50%\"\r\n                    innerRadius={30}\r\n                    outerRadius={60}\r\n                    label\r\n                  >\r\n                    {metrics.occFree.map((_,i)=>(\r\n                      <Cell key={i} fill={COLORS[(i+1)%COLORS.length]} />\r\n                    ))}\r\n                  </Pie>\r\n                  <PieTooltip/>\r\n                </PieChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Balance radar */}\r\n            <div className=\"chart-block\">\r\n              <h3>Balance Grupal (%)</h3>\r\n              <ResponsiveContainer width=\"100%\" height={200}>\r\n                <RadarChart data={metrics.trend[0] /* dummy, no usar */}>\r\n                  {/* reservado; podría usarse groupBalance si lo calculas */}\r\n                  <PolarGrid/>\r\n                  <PolarAngleAxis/>\r\n                  <PolarRadiusAxis/>\r\n                </RadarChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Tendencia semanal */}\r\n            <div className=\"chart-block full-width\">\r\n              <h3>Tendencia Semanal (%)</h3>\r\n              <ResponsiveContainer width=\"100%\" height={250}>\r\n                <LineChart data={metrics.trend}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\"/>\r\n                  <XAxis dataKey=\"date\"/>\r\n                  <YAxis/>\r\n                  <BarTooltip/>\r\n                  <Line type=\"monotone\" dataKey=\"Autocuidado\" stroke=\"#8884d8\"/>\r\n                  <Line type=\"monotone\" dataKey=\"Obligaciones\" stroke=\"#82ca9d\"/>\r\n                  <Line type=\"monotone\" dataKey=\"Ocio\" stroke=\"#ffc658\"/>\r\n                  <PieLegend/>\r\n                </LineChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n\r\n            {/* Patrón horario heatmap */}\r\n            <div className=\"chart-block full-width\">\r\n              <h3>Patrón Horario (min por hora)</h3>\r\n              <div className=\"heatmap\">\r\n                {metrics.patternHourly.map((h,i)=>(\r\n                  <div\r\n                    key={i}\r\n                    className=\"heatmap-cell\"\r\n                    style={{\r\n                      background: `rgba(124,99,246,${h.minutes/ Math.max(...metrics.patternHourly.map(x=>x.minutes||1))})`\r\n                    }}\r\n                    title={`${h.hour}: ${h.minutes} min`}\r\n                  >\r\n                    {h.hour}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Bloques prolongados */}\r\n            <div className=\"chart-block full-width\">\r\n              <h3>Bloques Prolongados (≥2h)</h3>\r\n              {metrics.prolongedBlocks.length===0 ? (\r\n                <p>No hay bloques prolongados.</p>\r\n              ) : (\r\n                <table className=\"blocks-table\">\r\n                  <thead>\r\n                    <tr><th>Inicio</th><th>Fin</th><th>Duración (min)</th></tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {metrics.prolongedBlocks.map((b,i)=>(\r\n                      <tr key={i}>\r\n                        <td>{b.start}</td>\r\n                        <td>{b.end}</td>\r\n                        <td>{b.duration}</td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PatientRoutines;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}