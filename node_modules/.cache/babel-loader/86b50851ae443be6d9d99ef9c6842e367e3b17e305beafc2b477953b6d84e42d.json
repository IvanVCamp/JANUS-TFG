{"ast":null,"code":"// src/components/TherapistTemplateManager.js\nimport React,{useState,useEffect}from'react';import axios from'axios';import templateService from'../services/templateService';import assignedService from'../services/assignedRoutineService';import'../styles/therapistTemplateManager.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function TherapistTemplateManager(){const[templates,setTemplates]=useState([]);const[patients,setPatients]=useState([]);const[modalNew,setModalNew]=useState(false);const[modalAssign,setModalAssign]=useState(null);const[formTpl,setFormTpl]=useState({title:'',description:'',type:'Terapia',duration:30});useEffect(()=>{const token=localStorage.getItem('token');// Cargar plantillas de rutina y garantizar siempre un array\ntemplateService.getAll(token).then(res=>{const tpls=Array.isArray(res.data)?res.data:[];setTemplates(tpls);}).catch(()=>{setTemplates([]);});// Cargar lista de pacientes y garantizar siempre un array\naxios.get('/api/therapist/patients',{headers:{'x-auth-token':token}}).then(res=>{const pts=Array.isArray(res.data)?res.data:[];setPatients(pts);}).catch(()=>{setPatients([]);});},[]);const handleSaveTpl=async e=>{e.preventDefault();const token=localStorage.getItem('token');try{const res=await templateService.create(formTpl,token);const newTpl=res.data;setTemplates(prev=>[newTpl,...prev]);setModalNew(false);}catch(err){console.error('Error creando plantilla:',err);}};const assignTo=async(tplId,patientId)=>{const token=localStorage.getItem('token');try{await assignedService.assign({templateId:tplId,patientId},token);setModalAssign(null);}catch(err){console.error('Error al asignar rutina:',err);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"tm-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"tm-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Gesti\\xF3n de Plantillas de Rutinas\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalNew(true),children:\"+ Nueva Plantilla\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"tm-list\",children:templates.map(t=>/*#__PURE__*/_jsxs(\"div\",{className:\"tm-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:t.title}),/*#__PURE__*/_jsx(\"p\",{children:t.description}),/*#__PURE__*/_jsx(\"span\",{className:\"badge\",children:t.type}),/*#__PURE__*/_jsxs(\"span\",{className:\"badge\",children:[t.duration,\" min\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalAssign(t),children:\"Asignar \\u2192\"})]},t._id))}),modalNew&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"modal-content\",onSubmit:handleSaveTpl,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Nueva Plantilla\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"T\\xEDtulo\",required:true,value:formTpl.title,onChange:e=>setFormTpl({...formTpl,title:e.target.value})}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Descripci\\xF3n\",value:formTpl.description,onChange:e=>setFormTpl({...formTpl,description:e.target.value})}),/*#__PURE__*/_jsxs(\"select\",{value:formTpl.type,onChange:e=>setFormTpl({...formTpl,type:e.target.value}),children:[/*#__PURE__*/_jsx(\"option\",{value:\"Personal\",children:\"Personal\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Estudio\",children:\"Estudio\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Terapia\",children:\"Terapia\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Ocio\",children:\"Ocio\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Otro\",children:\"Otro\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"10\",max:\"180\",required:true,value:formTpl.duration,onChange:e=>setFormTpl({...formTpl,duration:+e.target.value})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Guardar\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setModalNew(false),children:\"Cancelar\"})]})}),modalAssign&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content assign\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Asignar: \",modalAssign.title]}),/*#__PURE__*/_jsxs(\"select\",{defaultValue:\"\",onChange:e=>{if(e.target.value)assignTo(modalAssign._id,e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"-- Selecciona Paciente --\"}),patients.map(p=>/*#__PURE__*/_jsxs(\"option\",{value:p._id,children:[p.nombre,\" \",p.apellidos]},p._id))]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalAssign(null),children:\"Cerrar\"})]})})]});}","map":{"version":3,"names":["React","useState","useEffect","axios","templateService","assignedService","jsx","_jsx","jsxs","_jsxs","TherapistTemplateManager","templates","setTemplates","patients","setPatients","modalNew","setModalNew","modalAssign","setModalAssign","formTpl","setFormTpl","title","description","type","duration","token","localStorage","getItem","getAll","then","res","tpls","Array","isArray","data","catch","get","headers","pts","handleSaveTpl","e","preventDefault","create","newTpl","prev","err","console","error","assignTo","tplId","patientId","assign","templateId","className","children","onClick","map","t","_id","onSubmit","placeholder","required","value","onChange","target","min","max","defaultValue","disabled","p","nombre","apellidos"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/TherapistTemplateManager.js"],"sourcesContent":["// src/components/TherapistTemplateManager.js\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport templateService from '../services/templateService';\r\nimport assignedService from '../services/assignedRoutineService';\r\nimport '../styles/therapistTemplateManager.css';\r\n\r\nexport default function TherapistTemplateManager() {\r\n  const [templates, setTemplates] = useState([]);\r\n  const [patients,  setPatients ] = useState([]);\r\n  const [modalNew,  setModalNew ] = useState(false);\r\n  const [modalAssign,setModalAssign] = useState(null);\r\n  const [formTpl,   setFormTpl ] = useState({\r\n    title:       '',\r\n    description: '',\r\n    type:        'Terapia',\r\n    duration:    30\r\n  });\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n\r\n    // Cargar plantillas de rutina y garantizar siempre un array\r\n    templateService.getAll(token)\r\n      .then(res => {\r\n        const tpls = Array.isArray(res.data) ? res.data : [];\r\n        setTemplates(tpls);\r\n      })\r\n      .catch(() => {\r\n        setTemplates([]);\r\n      });\r\n\r\n    // Cargar lista de pacientes y garantizar siempre un array\r\n    axios.get('/api/therapist/patients', {\r\n      headers: { 'x-auth-token': token }\r\n    })\r\n      .then(res => {\r\n        const pts = Array.isArray(res.data) ? res.data : [];\r\n        setPatients(pts);\r\n      })\r\n      .catch(() => {\r\n        setPatients([]);\r\n      });\r\n  }, []);\r\n\r\n  const handleSaveTpl = async e => {\r\n    e.preventDefault();\r\n    const token = localStorage.getItem('token');\r\n    try {\r\n      const res = await templateService.create(formTpl, token);\r\n      const newTpl = res.data;\r\n      setTemplates(prev => [ newTpl, ...prev ]);\r\n      setModalNew(false);\r\n    } catch (err) {\r\n      console.error('Error creando plantilla:', err);\r\n    }\r\n  };\r\n\r\n  const assignTo = async (tplId, patientId) => {\r\n    const token = localStorage.getItem('token');\r\n    try {\r\n      await assignedService.assign({ templateId: tplId, patientId }, token);\r\n      setModalAssign(null);\r\n    } catch (err) {\r\n      console.error('Error al asignar rutina:', err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"tm-container\">\r\n      <header className=\"tm-header\">\r\n        <h2>Gestión de Plantillas de Rutinas</h2>\r\n        <button onClick={() => setModalNew(true)}>+ Nueva Plantilla</button>\r\n      </header>\r\n\r\n      <div className=\"tm-list\">\r\n        {templates.map(t => (\r\n          <div className=\"tm-card\" key={t._id}>\r\n            <h3>{t.title}</h3>\r\n            <p>{t.description}</p>\r\n            <span className=\"badge\">{t.type}</span>\r\n            <span className=\"badge\">{t.duration} min</span>\r\n            <button onClick={() => setModalAssign(t)}>Asignar →</button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {modalNew && (\r\n        <div className=\"modal-overlay\">\r\n          <form className=\"modal-content\" onSubmit={handleSaveTpl}>\r\n            <h3>Nueva Plantilla</h3>\r\n            <input\r\n              type=\"text\" placeholder=\"Título\" required\r\n              value={formTpl.title}\r\n              onChange={e => setFormTpl({ ...formTpl, title: e.target.value })}\r\n            />\r\n            <textarea\r\n              placeholder=\"Descripción\"\r\n              value={formTpl.description}\r\n              onChange={e => setFormTpl({ ...formTpl, description: e.target.value })}\r\n            />\r\n            <select\r\n              value={formTpl.type}\r\n              onChange={e => setFormTpl({ ...formTpl, type: e.target.value })}\r\n            >\r\n              <option value=\"Personal\">Personal</option>\r\n              <option value=\"Estudio\">Estudio</option>\r\n              <option value=\"Terapia\">Terapia</option>\r\n              <option value=\"Ocio\">Ocio</option>\r\n              <option value=\"Otro\">Otro</option>\r\n            </select>\r\n            <input\r\n              type=\"number\" min=\"10\" max=\"180\" required\r\n              value={formTpl.duration}\r\n              onChange={e => setFormTpl({ ...formTpl, duration: +e.target.value })}\r\n            />\r\n            <button type=\"submit\">Guardar</button>\r\n            <button type=\"button\" onClick={() => setModalNew(false)}>Cancelar</button>\r\n          </form>\r\n        </div>\r\n      )}\r\n\r\n      {modalAssign && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal-content assign\">\r\n            <h3>Asignar: {modalAssign.title}</h3>\r\n            <select\r\n              defaultValue=\"\"\r\n              onChange={e => {\r\n                if (e.target.value) assignTo(modalAssign._id, e.target.value);\r\n              }}\r\n            >\r\n              <option value=\"\" disabled>-- Selecciona Paciente --</option>\r\n              {patients.map(p => (\r\n                <option key={p._id} value={p._id}>\r\n                  {p.nombre} {p.apellidos}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <button onClick={() => setModalAssign(null)}>Cerrar</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n);\r\n}\r\n"],"mappings":"AAAA;AAEA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,eAAe,KAAM,6BAA6B,CACzD,MAAO,CAAAC,eAAe,KAAM,oCAAoC,CAChE,MAAO,wCAAwC,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEhD,cAAe,SAAS,CAAAC,wBAAwBA,CAAA,CAAG,CACjD,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAGX,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAACY,QAAQ,CAAGC,WAAW,CAAE,CAAGb,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAACc,QAAQ,CAAGC,WAAW,CAAE,CAAGf,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACgB,WAAW,CAACC,cAAc,CAAC,CAAGjB,QAAQ,CAAC,IAAI,CAAC,CACnD,KAAM,CAACkB,OAAO,CAAIC,UAAU,CAAE,CAAGnB,QAAQ,CAAC,CACxCoB,KAAK,CAAQ,EAAE,CACfC,WAAW,CAAE,EAAE,CACfC,IAAI,CAAS,SAAS,CACtBC,QAAQ,CAAK,EACf,CAAC,CAAC,CAEFtB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAuB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAE3C;AACAvB,eAAe,CAACwB,MAAM,CAACH,KAAK,CAAC,CAC1BI,IAAI,CAACC,GAAG,EAAI,CACX,KAAM,CAAAC,IAAI,CAAGC,KAAK,CAACC,OAAO,CAACH,GAAG,CAACI,IAAI,CAAC,CAAGJ,GAAG,CAACI,IAAI,CAAG,EAAE,CACpDtB,YAAY,CAACmB,IAAI,CAAC,CACpB,CAAC,CAAC,CACDI,KAAK,CAAC,IAAM,CACXvB,YAAY,CAAC,EAAE,CAAC,CAClB,CAAC,CAAC,CAEJ;AACAT,KAAK,CAACiC,GAAG,CAAC,yBAAyB,CAAE,CACnCC,OAAO,CAAE,CAAE,cAAc,CAAEZ,KAAM,CACnC,CAAC,CAAC,CACCI,IAAI,CAACC,GAAG,EAAI,CACX,KAAM,CAAAQ,GAAG,CAAGN,KAAK,CAACC,OAAO,CAACH,GAAG,CAACI,IAAI,CAAC,CAAGJ,GAAG,CAACI,IAAI,CAAG,EAAE,CACnDpB,WAAW,CAACwB,GAAG,CAAC,CAClB,CAAC,CAAC,CACDH,KAAK,CAAC,IAAM,CACXrB,WAAW,CAAC,EAAE,CAAC,CACjB,CAAC,CAAC,CACN,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAyB,aAAa,CAAG,KAAM,CAAAC,CAAC,EAAI,CAC/BA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClB,KAAM,CAAAhB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CACF,KAAM,CAAAG,GAAG,CAAG,KAAM,CAAA1B,eAAe,CAACsC,MAAM,CAACvB,OAAO,CAAEM,KAAK,CAAC,CACxD,KAAM,CAAAkB,MAAM,CAAGb,GAAG,CAACI,IAAI,CACvBtB,YAAY,CAACgC,IAAI,EAAI,CAAED,MAAM,CAAE,GAAGC,IAAI,CAAE,CAAC,CACzC5B,WAAW,CAAC,KAAK,CAAC,CACpB,CAAE,MAAO6B,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAEF,GAAG,CAAC,CAChD,CACF,CAAC,CAED,KAAM,CAAAG,QAAQ,CAAG,KAAAA,CAAOC,KAAK,CAAEC,SAAS,GAAK,CAC3C,KAAM,CAAAzB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CACF,KAAM,CAAAtB,eAAe,CAAC8C,MAAM,CAAC,CAAEC,UAAU,CAAEH,KAAK,CAAEC,SAAU,CAAC,CAAEzB,KAAK,CAAC,CACrEP,cAAc,CAAC,IAAI,CAAC,CACtB,CAAE,MAAO2B,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,0BAA0B,CAAEF,GAAG,CAAC,CAChD,CACF,CAAC,CAED,mBACEpC,KAAA,QAAK4C,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3B7C,KAAA,WAAQ4C,SAAS,CAAC,WAAW,CAAAC,QAAA,eAC3B/C,IAAA,OAAA+C,QAAA,CAAI,qCAAgC,CAAI,CAAC,cACzC/C,IAAA,WAAQgD,OAAO,CAAEA,CAAA,GAAMvC,WAAW,CAAC,IAAI,CAAE,CAAAsC,QAAA,CAAC,mBAAiB,CAAQ,CAAC,EAC9D,CAAC,cAET/C,IAAA,QAAK8C,SAAS,CAAC,SAAS,CAAAC,QAAA,CACrB3C,SAAS,CAAC6C,GAAG,CAACC,CAAC,eACdhD,KAAA,QAAK4C,SAAS,CAAC,SAAS,CAAAC,QAAA,eACtB/C,IAAA,OAAA+C,QAAA,CAAKG,CAAC,CAACpC,KAAK,CAAK,CAAC,cAClBd,IAAA,MAAA+C,QAAA,CAAIG,CAAC,CAACnC,WAAW,CAAI,CAAC,cACtBf,IAAA,SAAM8C,SAAS,CAAC,OAAO,CAAAC,QAAA,CAAEG,CAAC,CAAClC,IAAI,CAAO,CAAC,cACvCd,KAAA,SAAM4C,SAAS,CAAC,OAAO,CAAAC,QAAA,EAAEG,CAAC,CAACjC,QAAQ,CAAC,MAAI,EAAM,CAAC,cAC/CjB,IAAA,WAAQgD,OAAO,CAAEA,CAAA,GAAMrC,cAAc,CAACuC,CAAC,CAAE,CAAAH,QAAA,CAAC,gBAAS,CAAQ,CAAC,GALhCG,CAAC,CAACC,GAM3B,CACN,CAAC,CACC,CAAC,CAEL3C,QAAQ,eACPR,IAAA,QAAK8C,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B7C,KAAA,SAAM4C,SAAS,CAAC,eAAe,CAACM,QAAQ,CAAEpB,aAAc,CAAAe,QAAA,eACtD/C,IAAA,OAAA+C,QAAA,CAAI,iBAAe,CAAI,CAAC,cACxB/C,IAAA,UACEgB,IAAI,CAAC,MAAM,CAACqC,WAAW,CAAC,WAAQ,CAACC,QAAQ,MACzCC,KAAK,CAAE3C,OAAO,CAACE,KAAM,CACrB0C,QAAQ,CAAEvB,CAAC,EAAIpB,UAAU,CAAC,CAAE,GAAGD,OAAO,CAAEE,KAAK,CAAEmB,CAAC,CAACwB,MAAM,CAACF,KAAM,CAAC,CAAE,CAClE,CAAC,cACFvD,IAAA,aACEqD,WAAW,CAAC,gBAAa,CACzBE,KAAK,CAAE3C,OAAO,CAACG,WAAY,CAC3ByC,QAAQ,CAAEvB,CAAC,EAAIpB,UAAU,CAAC,CAAE,GAAGD,OAAO,CAAEG,WAAW,CAAEkB,CAAC,CAACwB,MAAM,CAACF,KAAM,CAAC,CAAE,CACxE,CAAC,cACFrD,KAAA,WACEqD,KAAK,CAAE3C,OAAO,CAACI,IAAK,CACpBwC,QAAQ,CAAEvB,CAAC,EAAIpB,UAAU,CAAC,CAAE,GAAGD,OAAO,CAAEI,IAAI,CAAEiB,CAAC,CAACwB,MAAM,CAACF,KAAM,CAAC,CAAE,CAAAR,QAAA,eAEhE/C,IAAA,WAAQuD,KAAK,CAAC,UAAU,CAAAR,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1C/C,IAAA,WAAQuD,KAAK,CAAC,SAAS,CAAAR,QAAA,CAAC,SAAO,CAAQ,CAAC,cACxC/C,IAAA,WAAQuD,KAAK,CAAC,SAAS,CAAAR,QAAA,CAAC,SAAO,CAAQ,CAAC,cACxC/C,IAAA,WAAQuD,KAAK,CAAC,MAAM,CAAAR,QAAA,CAAC,MAAI,CAAQ,CAAC,cAClC/C,IAAA,WAAQuD,KAAK,CAAC,MAAM,CAAAR,QAAA,CAAC,MAAI,CAAQ,CAAC,EAC5B,CAAC,cACT/C,IAAA,UACEgB,IAAI,CAAC,QAAQ,CAAC0C,GAAG,CAAC,IAAI,CAACC,GAAG,CAAC,KAAK,CAACL,QAAQ,MACzCC,KAAK,CAAE3C,OAAO,CAACK,QAAS,CACxBuC,QAAQ,CAAEvB,CAAC,EAAIpB,UAAU,CAAC,CAAE,GAAGD,OAAO,CAAEK,QAAQ,CAAE,CAACgB,CAAC,CAACwB,MAAM,CAACF,KAAM,CAAC,CAAE,CACtE,CAAC,cACFvD,IAAA,WAAQgB,IAAI,CAAC,QAAQ,CAAA+B,QAAA,CAAC,SAAO,CAAQ,CAAC,cACtC/C,IAAA,WAAQgB,IAAI,CAAC,QAAQ,CAACgC,OAAO,CAAEA,CAAA,GAAMvC,WAAW,CAAC,KAAK,CAAE,CAAAsC,QAAA,CAAC,UAAQ,CAAQ,CAAC,EACtE,CAAC,CACJ,CACN,CAEArC,WAAW,eACVV,IAAA,QAAK8C,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B7C,KAAA,QAAK4C,SAAS,CAAC,sBAAsB,CAAAC,QAAA,eACnC7C,KAAA,OAAA6C,QAAA,EAAI,WAAS,CAACrC,WAAW,CAACI,KAAK,EAAK,CAAC,cACrCZ,KAAA,WACE0D,YAAY,CAAC,EAAE,CACfJ,QAAQ,CAAEvB,CAAC,EAAI,CACb,GAAIA,CAAC,CAACwB,MAAM,CAACF,KAAK,CAAEd,QAAQ,CAAC/B,WAAW,CAACyC,GAAG,CAAElB,CAAC,CAACwB,MAAM,CAACF,KAAK,CAAC,CAC/D,CAAE,CAAAR,QAAA,eAEF/C,IAAA,WAAQuD,KAAK,CAAC,EAAE,CAACM,QAAQ,MAAAd,QAAA,CAAC,2BAAyB,CAAQ,CAAC,CAC3DzC,QAAQ,CAAC2C,GAAG,CAACa,CAAC,eACb5D,KAAA,WAAoBqD,KAAK,CAAEO,CAAC,CAACX,GAAI,CAAAJ,QAAA,EAC9Be,CAAC,CAACC,MAAM,CAAC,GAAC,CAACD,CAAC,CAACE,SAAS,GADZF,CAAC,CAACX,GAEP,CACT,CAAC,EACI,CAAC,cACTnD,IAAA,WAAQgD,OAAO,CAAEA,CAAA,GAAMrC,cAAc,CAAC,IAAI,CAAE,CAAAoC,QAAA,CAAC,QAAM,CAAQ,CAAC,EACzD,CAAC,CACH,CACN,EACE,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}