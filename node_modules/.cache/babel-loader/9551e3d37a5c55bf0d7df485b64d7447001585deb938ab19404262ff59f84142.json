{"ast":null,"code":"// src/components/PatientTemplates.js\nimport React,{useState,useEffect}from'react';import axios from'axios';import'../styles/routineTemplates.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplates(){const[instances,setInstances]=useState([]);const[filterTag,setFilterTag]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchInstances=async()=>{const token=localStorage.getItem('token');if(!token){setError('No estás autenticado. Por favor, inicia sesión.');setLoading(false);return;}try{const res=await axios.get('/api/routines/instances',{headers:{'x-auth-token':token}});// Aseguramos que siempre sea un array\nconst data=Array.isArray(res.data)?res.data:Array.isArray(res.data.instances)?res.data.instances:[];setInstances(data);}catch(err){var _err$response,_err$response$data;console.error('Error al cargar instancias:',err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Error al cargar plantillas');}finally{setLoading(false);}};fetchInstances();},[]);const toggleActivity=async(instanceId,activityId)=>{const token=localStorage.getItem('token');try{await axios.patch(`/api/routines/instances/${instanceId}/activities/${activityId}/toggle`,null,{headers:{'x-auth-token':token}});setInstances(prev=>prev.map(inst=>inst._id!==instanceId?inst:{...inst,activities:inst.activities.map(act=>act._id!==activityId?act:{...act,completed:!act.completed})}));}catch(err){console.error('Error cambiando estado de actividad:',err);setError('No se pudo actualizar el estado de la actividad');}};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando plantillas asignadas\\u2026\"});if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error});const filtered=instances.filter(inst=>{var _inst$template$tags;return filterTag?(_inst$template$tags=inst.template.tags)===null||_inst$template$tags===void 0?void 0:_inst$template$tags.includes(filterTag):true;});return/*#__PURE__*/_jsx(\"div\",{className:\"routine-templates-page patient-templates-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas Asignadas\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filtrar por etiqueta\",value:filterTag,onChange:e=>setFilterTag(e.target.value),className:\"small-input tag-filter\"})]}),!filtered.length?/*#__PURE__*/_jsx(\"p\",{children:\"No se encontraron plantillas con esa etiqueta.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"tpl-grid\",children:filtered.map(inst=>{var _inst$template$tags2;return/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"tpl-title\",children:inst.template.name}),/*#__PURE__*/_jsx(\"p\",{className:\"tpl-desc\",children:inst.template.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-meta\",children:[\"Duraci\\xF3n: \",inst.template.duration,\" min | Tags: \",(_inst$template$tags2=inst.template.tags)===null||_inst$template$tags2===void 0?void 0:_inst$template$tags2.join(', ')]}),/*#__PURE__*/_jsx(\"ul\",{className:\"tpl-activities-list\",children:inst.activities.map(act=>/*#__PURE__*/_jsxs(\"li\",{className:\"activity-item\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:act.completed,onChange:()=>toggleActivity(inst._id,act._id)}),/*#__PURE__*/_jsxs(\"span\",{className:act.completed?'completed':'',children:[act.name,\" \\u2013 Nivel \",act.challenge,\" \\u2013 \",act.minutes,\" min\"]})]}),act.desc&&/*#__PURE__*/_jsx(\"p\",{className:\"activity-desc\",children:act.desc})]},act._id))})]},inst._id);})})]})});}","map":{"version":3,"names":["React","useState","useEffect","axios","jsx","_jsx","jsxs","_jsxs","PatientTemplates","instances","setInstances","filterTag","setFilterTag","loading","setLoading","error","setError","fetchInstances","token","localStorage","getItem","res","get","headers","data","Array","isArray","err","_err$response","_err$response$data","console","response","message","toggleActivity","instanceId","activityId","patch","prev","map","inst","_id","activities","act","completed","children","className","filtered","filter","_inst$template$tags","template","tags","includes","type","placeholder","value","onChange","e","target","length","_inst$template$tags2","name","description","duration","join","checked","challenge","minutes","desc"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/components/PatientTemplates.js\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport '../styles/routineTemplates.css';\r\n\r\nexport default function PatientTemplates() {\r\n  const [instances, setInstances] = useState([]);\r\n  const [filterTag, setFilterTag] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchInstances = async () => {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        setError('No estás autenticado. Por favor, inicia sesión.');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n      try {\r\n        const res = await axios.get('/api/routines/instances', {\r\n          headers: { 'x-auth-token': token }\r\n        });\r\n        // Aseguramos que siempre sea un array\r\n        const data = Array.isArray(res.data)\r\n          ? res.data\r\n          : Array.isArray(res.data.instances)\r\n            ? res.data.instances\r\n            : [];\r\n        setInstances(data);\r\n      } catch (err) {\r\n        console.error('Error al cargar instancias:', err);\r\n        setError(err.response?.data?.message || 'Error al cargar plantillas');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchInstances();\r\n  }, []);\r\n\r\n  const toggleActivity = async (instanceId, activityId) => {\r\n    const token = localStorage.getItem('token');\r\n    try {\r\n      await axios.patch(\r\n        `/api/routines/instances/${instanceId}/activities/${activityId}/toggle`,\r\n        null,\r\n        { headers: { 'x-auth-token': token } }\r\n      );\r\n      setInstances(prev =>\r\n        prev.map(inst =>\r\n          inst._id !== instanceId\r\n            ? inst\r\n            : {\r\n                ...inst,\r\n                activities: inst.activities.map(act =>\r\n                  act._id !== activityId\r\n                    ? act\r\n                    : { ...act, completed: !act.completed }\r\n                )\r\n              }\r\n        )\r\n      );\r\n    } catch (err) {\r\n      console.error('Error cambiando estado de actividad:', err);\r\n      setError('No se pudo actualizar el estado de la actividad');\r\n    }\r\n  };\r\n\r\n  if (loading) return <p>Cargando plantillas asignadas…</p>;\r\n  if (error)   return <p className=\"error-msg\">{error}</p>;\r\n\r\n  const filtered = instances.filter(inst =>\r\n    filterTag\r\n      ? inst.template.tags?.includes(filterTag)\r\n      : true\r\n  );\r\n\r\n  return (\r\n    <div className=\"routine-templates-page patient-templates-page\">\r\n      <div className=\"tpl-container\">\r\n        <div className=\"tpl-header\">\r\n          <h1>Mis Plantillas Asignadas</h1>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Filtrar por etiqueta\"\r\n            value={filterTag}\r\n            onChange={e => setFilterTag(e.target.value)}\r\n            className=\"small-input tag-filter\"\r\n          />\r\n        </div>\r\n\r\n        {!filtered.length ? (\r\n          <p>No se encontraron plantillas con esa etiqueta.</p>\r\n        ) : (\r\n          <div className=\"tpl-grid\">\r\n            {filtered.map(inst => (\r\n              <div key={inst._id} className=\"tpl-card\">\r\n                <h2 className=\"tpl-title\">{inst.template.name}</h2>\r\n                <p className=\"tpl-desc\">{inst.template.description}</p>\r\n                <div className=\"tpl-meta\">\r\n                  Duración: {inst.template.duration} min | Tags: {inst.template.tags?.join(', ')}\r\n                </div>\r\n\r\n                <ul className=\"tpl-activities-list\">\r\n                  {inst.activities.map(act => (\r\n                    <li key={act._id} className=\"activity-item\">\r\n                      <label>\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={act.completed}\r\n                          onChange={() => toggleActivity(inst._id, act._id)}\r\n                        />\r\n                        <span className={act.completed ? 'completed' : ''}>\r\n                          {act.name} – Nivel {act.challenge} – {act.minutes} min\r\n                        </span>\r\n                      </label>\r\n                      {act.desc && <p className=\"activity-desc\">{act.desc}</p>}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}