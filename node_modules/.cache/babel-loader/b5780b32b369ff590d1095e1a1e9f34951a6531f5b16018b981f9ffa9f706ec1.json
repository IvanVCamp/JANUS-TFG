{"ast":null,"code":"// src/components/PatientTemplatesPage.js\nimport React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{FaChevronDown,FaChevronUp,FaCheckCircle,FaRegCircle}from'react-icons/fa';import'../styles/routineTemplates.css';// estilos de paciente: Mis Rutinas :contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const[instances,setInstances]=useState([]);const[expanded,setExpanded]=useState({});const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();// Extrae patientId desde el JWT para la URL\nconst token=localStorage.getItem('token');let patientId=null;try{var _decoded$user;const payload=token===null||token===void 0?void 0:token.split('.')[1];const decoded=payload&&JSON.parse(atob(payload));patientId=(decoded===null||decoded===void 0?void 0:(_decoded$user=decoded.user)===null||_decoded$user===void 0?void 0:_decoded$user.id)||(decoded===null||decoded===void 0?void 0:decoded.id);}catch(e){console.error('No se pudo decodificar JWT',e);}useEffect(()=>{if(!token){navigate('/login');return;}if(!patientId){setError('Usuario no identificado');setLoading(false);return;}fetch(`/api/routines/instances/${patientId}`,{headers:{'Content-Type':'application/json','x-auth-token':token}}).then(async res=>{if(res.status===401)throw new Error('Sesión expirada');if(!res.ok)throw new Error(`Error fetch: ${res.status}`);return res.json();}).then(data=>setInstances(data)).catch(err=>setError(err.message)).finally(()=>setLoading(false));},[navigate,token,patientId]);const toggleExpand=id=>{setExpanded(e=>({...e,[id]:!e[id]}));};const markActivity=(instanceId,idx)=>{fetch(`/api/routines/instances/${instanceId}/activities/${idx}`,{method:'POST',headers:{'Content-Type':'application/json','x-auth-token':token}}).then(res=>{if(!res.ok)throw new Error('No se pudo marcar actividad');// actualizar estado local\nsetInstances(insts=>insts.map(inst=>{if(inst._id!==instanceId)return inst;const acts=inst.activities.map((a,i)=>i===idx?{...a,completed:!a.completed}:a);return{...inst,activities:acts};}));}).catch(console.error);};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"patient-assigns\",children:\"Cargando\\u2026\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[\"Error: \",error]});return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Rutinas Asignadas\"}),instances.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"pt-empty\",children:\"No tienes rutinas asignadas por el momento.\"}):instances.map(inst=>{const total=inst.activities.length;const done=inst.activities.filter(a=>a.completed).length;const pct=Math.round(done/total*100);return/*#__PURE__*/_jsxs(\"div\",{className:`assign-card ${inst.status==='completed'?'status-completed':inst.status==='postponed'?'status-postponed':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"assign-header\",onClick:()=>toggleExpand(inst._id),children:[/*#__PURE__*/_jsx(\"h3\",{children:inst.template.name}),/*#__PURE__*/_jsxs(\"small\",{children:[done,\"/\",total,\" actividades (\",pct,\"%)\"]}),expanded[inst._id]?/*#__PURE__*/_jsx(FaChevronUp,{}):/*#__PURE__*/_jsx(FaChevronDown,{})]}),/*#__PURE__*/_jsx(\"p\",{className:\"pt-desc\",children:inst.template.description}),expanded[inst._id]&&/*#__PURE__*/_jsx(\"ul\",{className:\"pt-activities\",children:inst.activities.map((act,idx)=>/*#__PURE__*/_jsxs(\"li\",{className:\"pt-activity\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"pt-toggle\",onClick:()=>markActivity(inst._id,idx),children:act.completed?/*#__PURE__*/_jsx(FaCheckCircle,{}):/*#__PURE__*/_jsx(FaRegCircle,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-activity-info\",children:[/*#__PURE__*/_jsx(\"strong\",{children:act.name}),/*#__PURE__*/_jsx(\"p\",{children:act.desc})]}),/*#__PURE__*/_jsx(\"span\",{className:`pt-challenge ${act.challenge.toLowerCase()}`,children:act.challenge}),/*#__PURE__*/_jsxs(\"span\",{className:\"pt-minutes\",children:[act.minutes,\" min\"]})]},idx))})]},inst._id);})]});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","FaChevronDown","FaChevronUp","FaCheckCircle","FaRegCircle","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","instances","setInstances","expanded","setExpanded","loading","setLoading","error","setError","navigate","token","localStorage","getItem","patientId","_decoded$user","payload","split","decoded","JSON","parse","atob","user","id","e","console","fetch","headers","then","res","status","Error","ok","json","data","catch","err","message","finally","toggleExpand","markActivity","instanceId","idx","method","insts","map","inst","_id","acts","activities","a","i","completed","className","children","length","total","done","filter","pct","Math","round","onClick","template","name","description","act","desc","challenge","toLowerCase","minutes"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/components/PatientTemplatesPage.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  FaChevronDown,\r\n  FaChevronUp,\r\n  FaCheckCircle,\r\n  FaRegCircle\r\n} from 'react-icons/fa';\r\nimport '../styles/routineTemplates.css';  // estilos de paciente: Mis Rutinas :contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const [instances, setInstances] = useState([]);\r\n  const [expanded, setExpanded] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  // Extrae patientId desde el JWT para la URL\r\n  const token = localStorage.getItem('token');\r\n  let patientId = null;\r\n  try {\r\n    const payload = token?.split('.')[1];\r\n    const decoded = payload && JSON.parse(atob(payload));\r\n    patientId = decoded?.user?.id || decoded?.id;\r\n  } catch (e) {\r\n    console.error('No se pudo decodificar JWT', e);\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!token) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n    if (!patientId) {\r\n      setError('Usuario no identificado');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    fetch(`/api/routines/instances/${patientId}`, {\r\n      headers: { 'Content-Type': 'application/json', 'x-auth-token': token }\r\n    })\r\n      .then(async res => {\r\n        if (res.status === 401) throw new Error('Sesión expirada');\r\n        if (!res.ok) throw new Error(`Error fetch: ${res.status}`);\r\n        return res.json();\r\n      })\r\n      .then(data => setInstances(data))\r\n      .catch(err => setError(err.message))\r\n      .finally(() => setLoading(false));\r\n  }, [navigate, token, patientId]);\r\n\r\n  const toggleExpand = id => {\r\n    setExpanded(e => ({ ...e, [id]: !e[id] }));\r\n  };\r\n\r\n  const markActivity = (instanceId, idx) => {\r\n    fetch(`/api/routines/instances/${instanceId}/activities/${idx}`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', 'x-auth-token': token }\r\n    })\r\n      .then(res => {\r\n        if (!res.ok) throw new Error('No se pudo marcar actividad');\r\n        // actualizar estado local\r\n        setInstances(insts =>\r\n          insts.map(inst => {\r\n            if (inst._id !== instanceId) return inst;\r\n            const acts = inst.activities.map((a, i) =>\r\n              i === idx ? { ...a, completed: !a.completed } : a\r\n            );\r\n            return { ...inst, activities: acts };\r\n          })\r\n        );\r\n      })\r\n      .catch(console.error);\r\n  };\r\n\r\n  if (loading) return <div className=\"patient-assigns\">Cargando…</div>;\r\n  if (error) return <div className=\"patient-assigns\">Error: {error}</div>;\r\n\r\n  return (\r\n    <div className=\"patient-assigns\">\r\n      <h1>Mis Rutinas Asignadas</h1>\r\n      {instances.length === 0 ? (\r\n        <p className=\"pt-empty\">No tienes rutinas asignadas por el momento.</p>\r\n      ) : (\r\n        instances.map(inst => {\r\n          const total = inst.activities.length;\r\n          const done = inst.activities.filter(a => a.completed).length;\r\n          const pct = Math.round((done / total) * 100);\r\n          return (\r\n            <div\r\n              key={inst._id}\r\n              className={`assign-card ${\r\n                inst.status === 'completed'\r\n                  ? 'status-completed'\r\n                  : inst.status === 'postponed'\r\n                  ? 'status-postponed'\r\n                  : ''\r\n              }`}\r\n            >\r\n              <div className=\"assign-header\" onClick={() => toggleExpand(inst._id)}>\r\n                <h3>{inst.template.name}</h3>\r\n                <small>\r\n                  {done}/{total} actividades ({pct}%)\r\n                </small>\r\n                {expanded[inst._id] ? <FaChevronUp /> : <FaChevronDown />}\r\n              </div>\r\n              <p className=\"pt-desc\">{inst.template.description}</p>\r\n              {expanded[inst._id] && (\r\n                <ul className=\"pt-activities\">\r\n                  {inst.activities.map((act, idx) => (\r\n                    <li key={idx} className=\"pt-activity\">\r\n                      <button\r\n                        className=\"pt-toggle\"\r\n                        onClick={() => markActivity(inst._id, idx)}\r\n                      >\r\n                        {act.completed ? <FaCheckCircle /> : <FaRegCircle />}\r\n                      </button>\r\n                      <div className=\"pt-activity-info\">\r\n                        <strong>{act.name}</strong>\r\n                        <p>{act.desc}</p>\r\n                      </div>\r\n                      <span className={`pt-challenge ${act.challenge.toLowerCase()}`}>\r\n                        {act.challenge}\r\n                      </span>\r\n                      <span className=\"pt-minutes\">{act.minutes} min</span>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              )}\r\n            </div>\r\n          );\r\n        })\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}