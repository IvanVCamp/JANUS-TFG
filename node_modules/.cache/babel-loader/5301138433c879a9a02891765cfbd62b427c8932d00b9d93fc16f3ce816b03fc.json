{"ast":null,"code":"import React,{useState,useEffect}from'react';import'../styles/routineTemplates.css';import{FaChevronDown,FaChevronUp}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const[instances,setInstances]=useState([]);const[expanded,setExpanded]=useState({});const[filter,setFilter]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const token=localStorage.getItem('token');const patientId=localStorage.getItem('patientId');useEffect(()=>{if(!token||!patientId){setError('Debes iniciar sesión.');setLoading(false);return;}const headers={'Content-Type':'application/json','x-auth-token':token};fetch(`/api/routines/instances/${patientId}`,{headers}).then(async res=>{if(!res.ok){const msg=await res.text();throw new Error(msg);}return res.json();}).then(data=>setInstances(data)).catch(err=>setError(err.message)).finally(()=>setLoading(false));},[token,patientId]);const toggleExpand=id=>{setExpanded(e=>({...e,[id]:!e[id]}));};const handleMark=(instanceId,idx,completed)=>{const headers={'Content-Type':'application/json','x-auth-token':token};fetch(`/api/routines/instances/${instanceId}/activities/${idx}`,{method:'POST',headers,body:JSON.stringify({completed})}).then(res=>res.json()).then(_ref=>{let{completedActivities}=_ref;setInstances(insts=>insts.map(inst=>inst._id===instanceId?{...inst,completedActivities}:inst));}).catch(err=>alert('Error marcando actividad: '+err.message));};// Filtrar por nombre de plantilla\nconst filtered=instances.filter(inst=>inst.template.name.toLowerCase().includes(filter.toLowerCase()));if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"patient-assigns\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Cargando rutinas\\u2026\"})});if(error)return/*#__PURE__*/_jsx(\"div\",{className:\"patient-assigns\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Error: \",error]})});return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-assigns\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Rutinas\"}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-section\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar rutina...\",value:filter,onChange:e=>setFilter(e.target.value)})}),filtered.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay rutinas asignadas.\"}):filtered.map(inst=>{const tpl=inst.template;const done=new Set(inst.completedActivities);const allDone=done.size===tpl.activities.length;return/*#__PURE__*/_jsxs(\"div\",{className:`assign-card ${allDone?'status-completed':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"assign-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:tpl.name}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-toggle\",onClick:()=>toggleExpand(inst._id),children:expanded[inst._id]?/*#__PURE__*/_jsx(FaChevronUp,{}):/*#__PURE__*/_jsx(FaChevronDown,{})})]}),/*#__PURE__*/_jsx(\"small\",{children:tpl.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-meta\",children:[tpl.activities.length,\" actividades \\u2022 \",tpl.duration,\" min\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"assign-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-complete\",onClick:()=>tpl.activities.forEach((_,i)=>{if(!done.has(i))handleMark(inst._id,i,true);}),disabled:allDone,children:\"Completar todo\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-postpone\",children:\"Postergar\"})]}),expanded[inst._id]&&/*#__PURE__*/_jsx(\"ul\",{className:\"activity-list\",children:tpl.activities.map((act,i)=>/*#__PURE__*/_jsx(\"li\",{className:\"activity-item\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:done.has(i),onChange:()=>handleMark(inst._id,i,!done.has(i))}),act.name,\" (\",act.minutes,\"min) - \",/*#__PURE__*/_jsx(\"em\",{children:act.challenge})]})},i))})]},inst._id);})]});}","map":{"version":3,"names":["React","useState","useEffect","FaChevronDown","FaChevronUp","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","instances","setInstances","expanded","setExpanded","filter","setFilter","loading","setLoading","error","setError","token","localStorage","getItem","patientId","headers","fetch","then","res","ok","msg","text","Error","json","data","catch","err","message","finally","toggleExpand","id","e","handleMark","instanceId","idx","completed","method","body","JSON","stringify","_ref","completedActivities","insts","map","inst","_id","alert","filtered","template","name","toLowerCase","includes","className","children","type","placeholder","value","onChange","target","length","tpl","done","Set","allDone","size","activities","onClick","description","duration","forEach","_","i","has","disabled","act","checked","minutes","challenge"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport '../styles/routineTemplates.css';\r\nimport { FaChevronDown, FaChevronUp } from 'react-icons/fa';\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const [instances, setInstances] = useState([]);\r\n  const [expanded, setExpanded] = useState({});\r\n  const [filter, setFilter] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  const token = localStorage.getItem('token');\r\n  const patientId = localStorage.getItem('patientId');\r\n\r\n  useEffect(() => {\r\n    if (!token || !patientId) {\r\n      setError('Debes iniciar sesión.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    const headers = { 'Content-Type': 'application/json', 'x-auth-token': token };\r\n    fetch(`/api/routines/instances/${patientId}`, { headers })\r\n      .then(async res => {\r\n        if (!res.ok) {\r\n          const msg = await res.text();\r\n          throw new Error(msg);\r\n        }\r\n        return res.json();\r\n      })\r\n      .then(data => setInstances(data))\r\n      .catch(err => setError(err.message))\r\n      .finally(() => setLoading(false));\r\n  }, [token, patientId]);\r\n\r\n  const toggleExpand = id => {\r\n    setExpanded(e => ({ ...e, [id]: !e[id] }));\r\n  };\r\n\r\n  const handleMark = (instanceId, idx, completed) => {\r\n    const headers = { 'Content-Type': 'application/json', 'x-auth-token': token };\r\n    fetch(`/api/routines/instances/${instanceId}/activities/${idx}`, {\r\n      method: 'POST', headers,\r\n      body: JSON.stringify({ completed })\r\n    })\r\n      .then(res => res.json())\r\n      .then(({ completedActivities }) => {\r\n        setInstances(insts => insts.map(inst => \r\n          inst._id === instanceId ? { ...inst, completedActivities } : inst\r\n        ));\r\n      })\r\n      .catch(err => alert('Error marcando actividad: ' + err.message));\r\n  };\r\n\r\n  // Filtrar por nombre de plantilla\r\n  const filtered = instances.filter(inst =>\r\n    inst.template.name.toLowerCase().includes(filter.toLowerCase())\r\n  );\r\n\r\n  if (loading) return <div className=\"patient-assigns\"><p>Cargando rutinas…</p></div>;\r\n  if (error)   return <div className=\"patient-assigns\"><p>Error: {error}</p></div>;\r\n\r\n  return (\r\n    <div className=\"patient-assigns\">\r\n      <h1>Mis Rutinas</h1>\r\n      <div className=\"filter-section\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Buscar rutina...\"\r\n          value={filter}\r\n          onChange={e => setFilter(e.target.value)}\r\n        />\r\n      </div>\r\n\r\n      {filtered.length === 0 ? (\r\n        <p>No hay rutinas asignadas.</p>\r\n      ) : (\r\n        filtered.map(inst => {\r\n          const tpl = inst.template;\r\n          const done = new Set(inst.completedActivities);\r\n          const allDone = done.size === tpl.activities.length;\r\n          return (\r\n            <div\r\n              key={inst._id}\r\n              className={`assign-card ${allDone ? 'status-completed' : ''}`}\r\n            >\r\n              <div className=\"assign-header\">\r\n                <h3>{tpl.name}</h3>\r\n                <button className=\"btn-toggle\" onClick={() => toggleExpand(inst._id)}>\r\n                  {expanded[inst._id] ? <FaChevronUp/> : <FaChevronDown/>}\r\n                </button>\r\n              </div>\r\n              <small>{tpl.description}</small>\r\n              <div className=\"tpl-meta\">\r\n                {tpl.activities.length} actividades • {tpl.duration} min\r\n              </div>\r\n              <div className=\"assign-actions\">\r\n                <button\r\n                  className=\"btn-complete\"\r\n                  onClick={() => tpl.activities.forEach((_,i) => {\r\n                    if (!done.has(i)) handleMark(inst._id, i, true);\r\n                  })}\r\n                  disabled={allDone}\r\n                >Completar todo</button>\r\n                <button className=\"btn-postpone\">Postergar</button>\r\n              </div>\r\n\r\n              {expanded[inst._id] && (\r\n                <ul className=\"activity-list\">\r\n                  {tpl.activities.map((act, i) => (\r\n                    <li key={i} className=\"activity-item\">\r\n                      <label>\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={done.has(i)}\r\n                          onChange={() => handleMark(inst._id, i, !done.has(i))}\r\n                        />\r\n                        {act.name} ({act.minutes}min) - <em>{act.challenge}</em>\r\n                      </label>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              )}\r\n            </div>\r\n          );\r\n        })\r\n      )}\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}