{"ast":null,"code":"// src/pages/PatientTemplatesPage.js\nimport React,{useState,useEffect,useContext}from'react';import{AuthContext}from'../context/AuthContext';import'../styles/routineTemplates.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const{user}=useContext(AuthContext);// asume contiene { id, name, token }\nconst[instances,setInstances]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{if(!(user!==null&&user!==void 0&&user.id))return;fetch(`/api/routines/instances/${user.id}`,{headers:{'Authorization':`Bearer ${user.token}`}}).then(res=>res.json()).then(data=>setInstances(data)).catch(console.error).finally(()=>setLoading(false));},[user]);const markActivity=async(instanceId,idx)=>{await fetch(`/api/routines/instances/${instanceId}/activities/${idx}`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${user.token}`}});// actualizar estado local\nsetInstances(insts=>insts.map(inst=>{if(inst._id!==instanceId)return inst;const updated={...inst};updated.activities[idx].completed=!updated.activities[idx].completed;return updated;}));};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"routine-templates-page tpl-container\",children:\"Cargando...\"});return/*#__PURE__*/_jsx(\"div\",{className:\"routine-templates-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas Asignadas\"}),instances.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"empty-state\",children:\"\\uD83D\\uDE15 A\\xFAn no se te han asignado plantillas\"}):/*#__PURE__*/_jsx(\"div\",{className:\"tpl-grid\",children:instances.map(inst=>{const total=inst.activities.length;const done=inst.activities.filter(a=>a.completed).length;const progress=total?done/total*100:0;return/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-card patient-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:inst.template.name}),/*#__PURE__*/_jsx(\"p\",{className:\"tpl-desc\",children:inst.template.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-container\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Progreso: \",done,\"/\",total]}),/*#__PURE__*/_jsx(\"progress\",{value:progress,max:\"100\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"activity-list\",children:inst.activities.map((act,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"activity-item\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:act.completed,onChange:()=>markActivity(inst._id,idx)}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"activity-name\",children:act.name}),/*#__PURE__*/_jsx(\"small\",{className:\"activity-desc\",children:act.desc})]}),/*#__PURE__*/_jsx(\"span\",{className:\"challenge-indicator\",\"data-level\":act.challenge,children:act.challenge})]},idx))})]},inst._id);})})]})});}","map":{"version":3,"names":["React","useState","useEffect","useContext","AuthContext","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","user","instances","setInstances","loading","setLoading","id","fetch","headers","token","then","res","json","data","catch","console","error","finally","markActivity","instanceId","idx","method","insts","map","inst","_id","updated","activities","completed","className","children","length","total","done","filter","a","progress","template","name","description","value","max","act","type","checked","onChange","desc","challenge"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/pages/PatientTemplatesPage.js\r\nimport React, { useState, useEffect, useContext } from 'react';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport '../styles/routineTemplates.css';\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const { user } = useContext(AuthContext); // asume contiene { id, name, token }\r\n  const [instances, setInstances] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!user?.id) return;\r\n    fetch(`/api/routines/instances/${user.id}`, {\r\n      headers: { 'Authorization': `Bearer ${user.token}` }\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => setInstances(data))\r\n      .catch(console.error)\r\n      .finally(() => setLoading(false));\r\n  }, [user]);\r\n\r\n  const markActivity = async (instanceId, idx) => {\r\n    await fetch(`/api/routines/instances/${instanceId}/activities/${idx}`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${user.token}`\r\n      }\r\n    });\r\n    // actualizar estado local\r\n    setInstances(insts => insts.map(inst => {\r\n      if (inst._id !== instanceId) return inst;\r\n      const updated = { ...inst };\r\n      updated.activities[idx].completed = !updated.activities[idx].completed;\r\n      return updated;\r\n    }));\r\n  };\r\n\r\n  if (loading) return <div className=\"routine-templates-page tpl-container\">Cargando...</div>;\r\n\r\n  return (\r\n    <div className=\"routine-templates-page\">\r\n      <div className=\"tpl-container\">\r\n        <h1>Mis Plantillas Asignadas</h1>\r\n\r\n        {instances.length === 0 ? (\r\n          <div className=\"empty-state\">\r\n            ðŸ˜• AÃºn no se te han asignado plantillas\r\n          </div>\r\n        ) : (\r\n          <div className=\"tpl-grid\">\r\n            {instances.map(inst => {\r\n              const total = inst.activities.length;\r\n              const done = inst.activities.filter(a => a.completed).length;\r\n              const progress = total ? (done / total) * 100 : 0;\r\n\r\n              return (\r\n                <div key={inst._id} className=\"tpl-card patient-card\">\r\n                  <h2>{inst.template.name}</h2>\r\n                  <p className=\"tpl-desc\">{inst.template.description}</p>\r\n\r\n                  <div className=\"progress-container\">\r\n                    <label>Progreso: {done}/{total}</label>\r\n                    <progress value={progress} max=\"100\"></progress>\r\n                  </div>\r\n\r\n                  <div className=\"activity-list\">\r\n                    {inst.activities.map((act, idx) => (\r\n                      <div key={idx} className=\"activity-item\">\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={act.completed}\r\n                          onChange={() => markActivity(inst._id, idx)}\r\n                        />\r\n                        <div className=\"activity-info\">\r\n                          <span className=\"activity-name\">{act.name}</span>\r\n                          <small className=\"activity-desc\">{act.desc}</small>\r\n                        </div>\r\n                        <span className=\"challenge-indicator\" data-level={act.challenge}>\r\n                          {act.challenge}\r\n                        </span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}