{"ast":null,"code":"// src/pages/PatientTemplatesPage.js\nimport React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import'../styles/patientTemplates.css';import{FaCheckCircle,FaRegCircle,FaChevronDown,FaChevronUp}from'react-icons/fa';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientTemplatesPage(){const[templates,setTemplates]=useState([]);const[expanded,setExpanded]=useState({});const[filter,setFilter]=useState('all');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();const token=localStorage.getItem('token');// Fetch assigned templates for this patient\nuseEffect(()=>{if(!token)return navigate('/login');(async()=>{try{const res=await fetch('/api/patient/templates',{headers:{'Content-Type':'application/json','x-auth-token':token}});if(res.status===401)return navigate('/login');if(!res.ok)throw new Error(`Error ${res.status}`);const data=await res.json();setTemplates(data);}catch(err){console.error(err);setError(err.message);}finally{setLoading(false);}})();},[navigate,token]);// Toggle completion of a specific activity\nconst toggleActivity=useCallback(async(tplId,idx)=>{try{// Optimistic update\nsetTemplates(ts=>ts.map(t=>{if(t._id!==tplId)return t;const activities=t.activities.map((a,i)=>i===idx?{...a,completed:!a.completed}:a);return{...t,activities};}));// send to backend\nawait fetch(`/api/patient/templates/${tplId}/activities/${idx}/toggle`,{method:'PATCH',headers:{'Content-Type':'application/json','x-auth-token':token}});}catch(err){console.error('toggle failed',err);}},[token]);// Expand/collapse template details\nconst toggleExpand=tplId=>{setExpanded(e=>({...e,[tplId]:!e[tplId]}));};// Filter templates by completion status\nconst filtered=templates.filter(t=>{if(filter==='all')return true;const doneCount=t.activities.filter(a=>a.completed).length;return filter==='completed'?doneCount===t.activities.length:doneCount<t.activities.length;});if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"pt-container\",children:\"Cargando tus plantillas\\u2026\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"pt-container error\",children:[\"Error: \",error]});return/*#__PURE__*/_jsxs(\"div\",{className:\"patient-templates-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pt-toolbar\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas\"}),/*#__PURE__*/_jsxs(\"select\",{value:filter,onChange:e=>setFilter(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"Todas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"Completadas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"pending\",children:\"Pendientes\"})]})]}),filtered.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"pt-empty\",children:\"\\uD83D\\uDE14 No hay plantillas que coincidan con tu filtro.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"pt-list\",children:filtered.map(tpl=>{const done=tpl.activities.filter(a=>a.completed).length;const total=tpl.activities.length;const pct=Math.round(done/total*100);const isExp=expanded[tpl._id]||false;return/*#__PURE__*/_jsxs(\"div\",{className:\"pt-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pt-header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:tpl.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-progress\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pt-bar\",style:{width:`${pct}%`}}),/*#__PURE__*/_jsxs(\"span\",{children:[done,\"/\",total,\" completadas (\",pct,\"%)\"]})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"pt-expand\",onClick:()=>toggleExpand(tpl._id),children:isExp?/*#__PURE__*/_jsx(FaChevronUp,{}):/*#__PURE__*/_jsx(FaChevronDown,{})})]}),isExp&&/*#__PURE__*/_jsx(\"ul\",{className:\"pt-activities\",children:tpl.activities.map((act,idx)=>/*#__PURE__*/_jsxs(\"li\",{className:act.completed?'done':'',children:[/*#__PURE__*/_jsx(\"button\",{className:\"pt-check\",onClick:()=>toggleActivity(tpl._id,idx),children:act.completed?/*#__PURE__*/_jsx(FaCheckCircle,{}):/*#__PURE__*/_jsx(FaRegCircle,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-desc\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"pt-name\",children:act.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"pt-detail\",children:[act.desc,\" \\u2022 Reto: \",act.challenge,\" \\u2022 \",act.minutes,\" min\"]})]})]},idx))})]},tpl._id);})})]});}","map":{"version":3,"names":["React","useState","useEffect","useCallback","useNavigate","FaCheckCircle","FaRegCircle","FaChevronDown","FaChevronUp","jsx","_jsx","jsxs","_jsxs","PatientTemplatesPage","templates","setTemplates","expanded","setExpanded","filter","setFilter","loading","setLoading","error","setError","navigate","token","localStorage","getItem","res","fetch","headers","status","ok","Error","data","json","err","console","message","toggleActivity","tplId","idx","ts","map","t","_id","activities","a","i","completed","method","toggleExpand","e","filtered","doneCount","length","className","children","value","onChange","target","tpl","done","total","pct","Math","round","isExp","name","style","width","onClick","act","desc","challenge","minutes"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["// src/pages/PatientTemplatesPage.js\r\nimport React, { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport '../styles/patientTemplates.css';\r\nimport { FaCheckCircle, FaRegCircle, FaChevronDown, FaChevronUp } from 'react-icons/fa';\r\n\r\nexport default function PatientTemplatesPage() {\r\n  const [templates, setTemplates] = useState([]);\r\n  const [expanded, setExpanded]   = useState({});\r\n  const [filter, setFilter]       = useState('all');\r\n  const [loading, setLoading]     = useState(true);\r\n  const [error, setError]         = useState(null);\r\n  const navigate = useNavigate();\r\n  const token = localStorage.getItem('token');\r\n\r\n  // Fetch assigned templates for this patient\r\n  useEffect(() => {\r\n    if (!token) return navigate('/login');\r\n    (async () => {\r\n      try {\r\n        const res = await fetch('/api/patient/templates', {\r\n          headers: { 'Content-Type':'application/json', 'x-auth-token':token }\r\n        });\r\n        if (res.status === 401) return navigate('/login');\r\n        if (!res.ok) throw new Error(`Error ${res.status}`);\r\n        const data = await res.json();\r\n        setTemplates(data);\r\n      } catch (err) {\r\n        console.error(err);\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n  }, [navigate, token]);\r\n\r\n  // Toggle completion of a specific activity\r\n  const toggleActivity = useCallback(async (tplId, idx) => {\r\n    try {\r\n      // Optimistic update\r\n      setTemplates(ts => ts.map(t => {\r\n        if (t._id !== tplId) return t;\r\n        const activities = t.activities.map((a,i) =>\r\n          i === idx ? { ...a, completed: !a.completed } : a\r\n        );\r\n        return { ...t, activities };\r\n      }));\r\n      // send to backend\r\n      await fetch(`/api/patient/templates/${tplId}/activities/${idx}/toggle`, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type':'application/json','x-auth-token':token }\r\n      });\r\n    } catch (err) {\r\n      console.error('toggle failed', err);\r\n    }\r\n  }, [token]);\r\n\r\n  // Expand/collapse template details\r\n  const toggleExpand = tplId => {\r\n    setExpanded(e => ({ ...e, [tplId]: !e[tplId] }));\r\n  };\r\n\r\n  // Filter templates by completion status\r\n  const filtered = templates.filter(t => {\r\n    if (filter === 'all') return true;\r\n    const doneCount = t.activities.filter(a=>a.completed).length;\r\n    return filter === 'completed' ? doneCount === t.activities.length\r\n                                  : doneCount < t.activities.length;\r\n  });\r\n\r\n  if (loading) return <div className=\"pt-container\">Cargando tus plantillasâ€¦</div>;\r\n  if (error)   return <div className=\"pt-container error\">Error: {error}</div>;\r\n\r\n  return (\r\n    <div className=\"patient-templates-page\">\r\n      <div className=\"pt-toolbar\">\r\n        <h1>Mis Plantillas</h1>\r\n        <select value={filter} onChange={e=>setFilter(e.target.value)}>\r\n          <option value=\"all\">Todas</option>\r\n          <option value=\"completed\">Completadas</option>\r\n          <option value=\"pending\">Pendientes</option>\r\n        </select>\r\n      </div>\r\n\r\n      {filtered.length === 0 ? (\r\n        <div className=\"pt-empty\">\r\n          ðŸ˜” No hay plantillas que coincidan con tu filtro.\r\n        </div>\r\n      ) : (\r\n        <div className=\"pt-list\">\r\n          {filtered.map(tpl => {\r\n            const done = tpl.activities.filter(a=>a.completed).length;\r\n            const total = tpl.activities.length;\r\n            const pct = Math.round(done/total*100);\r\n            const isExp = expanded[tpl._id] || false;\r\n            return (\r\n              <div key={tpl._id} className=\"pt-card\">\r\n                <div className=\"pt-header\">\r\n                  <div>\r\n                    <h2>{tpl.name}</h2>\r\n                    <div className=\"pt-progress\">\r\n                      <div className=\"pt-bar\" style={{width:`${pct}%`}}/>\r\n                      <span>{done}/{total} completadas ({pct}%)</span>\r\n                    </div>\r\n                  </div>\r\n                  <button className=\"pt-expand\"\r\n                          onClick={()=>toggleExpand(tpl._id)}>\r\n                    {isExp ? <FaChevronUp/> : <FaChevronDown/>}\r\n                  </button>\r\n                </div>\r\n                {isExp && (\r\n                  <ul className=\"pt-activities\">\r\n                    {tpl.activities.map((act,idx) => (\r\n                      <li key={idx} className={act.completed?'done':''}>\r\n                        <button\r\n                          className=\"pt-check\"\r\n                          onClick={()=>toggleActivity(tpl._id, idx)}\r\n                        >\r\n                          {act.completed\r\n                            ? <FaCheckCircle/>\r\n                            : <FaRegCircle/>}\r\n                        </button>\r\n                        <div className=\"pt-desc\">\r\n                          <span className=\"pt-name\">{act.name}</span>\r\n                          <span className=\"pt-detail\">\r\n                            {act.desc} â€¢ Reto: {act.challenge} â€¢ {act.minutes} min\r\n                          </span>\r\n                        </div>\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}