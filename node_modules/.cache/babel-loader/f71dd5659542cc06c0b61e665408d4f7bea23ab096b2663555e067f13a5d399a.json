{"ast":null,"code":"// src/components/PatientInterests.js\nimport React,{useState,useEffect}from'react';import{useParams,Link}from'react-router-dom';import axios from'axios';import{ResponsiveContainer,BarChart,Bar,XAxis,YAxis,Tooltip,Legend,PieChart,Pie,Cell}from'recharts';import'../styles/therapistRoutines.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PatientInterests(){const{patientId}=useParams();// diary: undefined = loading, null = no diary found, array = entries\nconst[diary,setDiary]=useState(undefined);const[metrics,setMetrics]=useState(null);// 1) Fetch the diary\nuseEffect(()=>{const fetchDiary=async()=>{try{const token=localStorage.getItem('token');const{data}=await axios.get(`/api/emotions?patientId=${patientId}`,{headers:{'x-auth-token':token}});if(data&&data.length>0){setDiary(data[0].diary);}else{setDiary(null);}}catch(err){console.error('Error fetching diary:',err);setDiary(null);}};fetchDiary();},[patientId]);// 2) Compute metrics once diary is loaded\nuseEffect(()=>{if(!Array.isArray(diary)||diary.length===0)return;// Average rating\nconst ratings=diary.map(e=>e.rating);const average=(ratings.reduce((a,b)=>a+b,0)/ratings.length).toFixed(2);// Distribution of ratings 1–5\nconst distribution=[1,2,3,4,5].map(r=>({rating:r,count:ratings.filter(x=>x===r).length}));// Activity-by-activity data\nconst activities=diary.map(e=>({name:e.title,rating:e.rating}));setMetrics({average,distribution,activities});},[diary]);// 3) Render guards\nif(diary===undefined){return/*#__PURE__*/_jsxs(\"div\",{className:\"routines-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"routines-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/interests\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Estad\\xEDsticas de Emociones\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"Cargando diario de emociones\\u2026\"})]});}if(diary===null){return/*#__PURE__*/_jsxs(\"div\",{className:\"routines-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"routines-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/interests\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Estad\\xEDsticas de Emociones\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"No se ha encontrado un diario guardado para este paciente.\"})]});}// 4) Once metrics ready, render charts\nif(!metrics){return/*#__PURE__*/_jsxs(\"div\",{className:\"routines-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"routines-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/interests\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Estad\\xEDsticas de Emociones\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"Calculando estad\\xEDsticas\\u2026\"})]});}const COLORS=['#8884d8','#82ca9d','#ffc658','#ff8042','#0088FE'];return/*#__PURE__*/_jsxs(\"div\",{className:\"routines-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"routines-header\",children:[/*#__PURE__*/_jsx(Link,{to:\"/therapist/interests\",children:\"\\u2190 Volver\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Estad\\xEDsticas de Emociones\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metrics-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"metric-card\",children:[\"Promedio de Calificaci\\xF3n: \",/*#__PURE__*/_jsx(\"strong\",{children:metrics.average})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"metric-card\",children:[\"N\\xFAmero de Actividades: \",/*#__PURE__*/_jsx(\"strong\",{children:metrics.activities.length})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"charts-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Distribuci\\xF3n de Calificaciones\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:250,children:/*#__PURE__*/_jsxs(PieChart,{children:[/*#__PURE__*/_jsx(Pie,{data:metrics.distribution,dataKey:\"count\",nameKey:\"rating\",cx:\"50%\",cy:\"50%\",outerRadius:80,label:true,children:metrics.distribution.map((entry,index)=>/*#__PURE__*/_jsx(Cell,{fill:COLORS[index%COLORS.length]},index))}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{verticalAlign:\"bottom\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-block full-width\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Calificaci\\xF3n por Actividad\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(BarChart,{data:metrics.activities,margin:{top:20,right:30,left:0,bottom:0},children:[/*#__PURE__*/_jsx(XAxis,{dataKey:\"name\"}),/*#__PURE__*/_jsx(YAxis,{domain:[1,5]}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"rating\",fill:\"#82ca9d\"})]})})]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useParams","Link","axios","ResponsiveContainer","BarChart","Bar","XAxis","YAxis","Tooltip","Legend","PieChart","Pie","Cell","jsx","_jsx","jsxs","_jsxs","PatientInterests","patientId","diary","setDiary","undefined","metrics","setMetrics","fetchDiary","token","localStorage","getItem","data","get","headers","length","err","console","error","Array","isArray","ratings","map","e","rating","average","reduce","a","b","toFixed","distribution","r","count","filter","x","activities","name","title","className","children","to","COLORS","width","height","dataKey","nameKey","cx","cy","outerRadius","label","entry","index","fill","verticalAlign","margin","top","right","left","bottom","domain"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientInterests.js"],"sourcesContent":["// src/components/PatientInterests.js\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport {\r\n  ResponsiveContainer,\r\n  BarChart, Bar, XAxis, YAxis, Tooltip, Legend,\r\n  PieChart, Pie, Cell\r\n} from 'recharts';\r\nimport '../styles/therapistRoutines.css';\r\n\r\nexport default function PatientInterests() {\r\n  const { patientId } = useParams();\r\n  // diary: undefined = loading, null = no diary found, array = entries\r\n  const [diary, setDiary] = useState(undefined);\r\n  const [metrics, setMetrics] = useState(null);\r\n\r\n  // 1) Fetch the diary\r\n  useEffect(() => {\r\n    const fetchDiary = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const { data } = await axios.get(`/api/emotions?patientId=${patientId}`, {\r\n          headers: { 'x-auth-token': token }\r\n        });\r\n        if (data && data.length > 0) {\r\n          setDiary(data[0].diary);\r\n        } else {\r\n          setDiary(null);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error fetching diary:', err);\r\n        setDiary(null);\r\n      }\r\n    };\r\n    fetchDiary();\r\n  }, [patientId]);\r\n\r\n  // 2) Compute metrics once diary is loaded\r\n  useEffect(() => {\r\n    if (!Array.isArray(diary) || diary.length === 0) return;\r\n\r\n    // Average rating\r\n    const ratings = diary.map(e => e.rating);\r\n    const average = (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(2);\r\n\r\n    // Distribution of ratings 1–5\r\n    const distribution = [1, 2, 3, 4, 5].map(r => ({\r\n      rating: r,\r\n      count: ratings.filter(x => x === r).length\r\n    }));\r\n\r\n    // Activity-by-activity data\r\n    const activities = diary.map(e => ({\r\n      name: e.title,\r\n      rating: e.rating\r\n    }));\r\n\r\n    setMetrics({ average, distribution, activities });\r\n  }, [diary]);\r\n\r\n  // 3) Render guards\r\n  if (diary === undefined) {\r\n    return (\r\n      <div className=\"routines-container\">\r\n        <header className=\"routines-header\">\r\n          <Link to=\"/therapist/interests\">← Volver</Link>\r\n          <h2>Estadísticas de Emociones</h2>\r\n        </header>\r\n        <p>Cargando diario de emociones…</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (diary === null) {\r\n    return (\r\n      <div className=\"routines-container\">\r\n        <header className=\"routines-header\">\r\n          <Link to=\"/therapist/interests\">← Volver</Link>\r\n          <h2>Estadísticas de Emociones</h2>\r\n        </header>\r\n        <p>No se ha encontrado un diario guardado para este paciente.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 4) Once metrics ready, render charts\r\n  if (!metrics) {\r\n    return (\r\n      <div className=\"routines-container\">\r\n        <header className=\"routines-header\">\r\n          <Link to=\"/therapist/interests\">← Volver</Link>\r\n          <h2>Estadísticas de Emociones</h2>\r\n        </header>\r\n        <p>Calculando estadísticas…</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const COLORS = ['#8884d8', '#82ca9d', '#ffc658', '#ff8042', '#0088FE'];\r\n\r\n  return (\r\n    <div className=\"routines-container\">\r\n      <header className=\"routines-header\">\r\n        <Link to=\"/therapist/interests\">← Volver</Link>\r\n        <h2>Estadísticas de Emociones</h2>\r\n      </header>\r\n\r\n      <div className=\"metrics-grid\">\r\n        <div className=\"metric-card\">\r\n          Promedio de Calificación: <strong>{metrics.average}</strong>\r\n        </div>\r\n        <div className=\"metric-card\">\r\n          Número de Actividades: <strong>{metrics.activities.length}</strong>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"charts-grid\">\r\n        <div className=\"chart-block\">\r\n          <h3>Distribución de Calificaciones</h3>\r\n          <ResponsiveContainer width=\"100%\" height={250}>\r\n            <PieChart>\r\n              <Pie\r\n                data={metrics.distribution}\r\n                dataKey=\"count\"\r\n                nameKey=\"rating\"\r\n                cx=\"50%\"\r\n                cy=\"50%\"\r\n                outerRadius={80}\r\n                label\r\n              >\r\n                {metrics.distribution.map((entry, index) => (\r\n                  <Cell key={index} fill={COLORS[index % COLORS.length]} />\r\n                ))}\r\n              </Pie>\r\n              <Tooltip />\r\n              <Legend verticalAlign=\"bottom\" />\r\n            </PieChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n\r\n        <div className=\"chart-block full-width\">\r\n          <h3>Calificación por Actividad</h3>\r\n          <ResponsiveContainer width=\"100%\" height={300}>\r\n            <BarChart\r\n              data={metrics.activities}\r\n              margin={{ top: 20, right: 30, left: 0, bottom: 0 }}\r\n            >\r\n              <XAxis dataKey=\"name\" />\r\n              <YAxis domain={[1, 5]} />\r\n              <Tooltip />\r\n              <Bar dataKey=\"rating\" fill=\"#82ca9d\" />\r\n            </BarChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}