{"ast":null,"code":"// src/components/PatientTemplateDetail.js\nimport React,{useState,useEffect}from'react';import{useParams,Link,useLocation}from'react-router-dom';import axios from'axios';import'../styles/routineTemplates.css';/**\r\n * Decodifica un JWT y devuelve su payload como objeto,\r\n * o null si falla.\r\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function decodeJwt(token){try{const b64Url=token.split('.')[1];const b64=b64Url.replace(/-/g,'+').replace(/_/g,'/');const json=atob(b64);return JSON.parse(json);}catch{return null;}}/**\r\n * Obtiene el patientId de:\r\n * 1) payload del JWT (id, sub o user.id),\r\n * 2) fallback a localStorage.userId si lo guardas en login.\r\n */function getPatientId(){const raw=localStorage.getItem('token')||'';const token=raw.startsWith('Bearer ')?raw.slice(7):raw;const payload=decodeJwt(token);if(payload){var _payload$user;return payload.id||payload.sub||((_payload$user=payload.user)===null||_payload$user===void 0?void 0:_payload$user.id)||null;}return localStorage.getItem('userId');}export default function PatientTemplateDetail(){var _location$state,_template$tags;const{instanceId}=useParams();const location=useLocation();const[instance,setInstance]=useState(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.instance)||null);const[loading,setLoading]=useState(!instance);const[error,setError]=useState(null);useEffect(()=>{if(instance)return;const fetchDetail=async()=>{const token=localStorage.getItem('token');const patientId=getPatientId();if(!token||!patientId){setError('No estás autenticado. Por favor, inicia sesión.');setLoading(false);return;}try{// Traemos todas las instancias de este paciente\nconst res=await axios.get(`/api/routines/instances/${patientId}`,{headers:{'x-auth-token':token}});// Buscamos la que coincide con instanceId\nconst found=Array.isArray(res.data)?res.data.find(i=>i._id===instanceId):Array.isArray(res.data.instances)?res.data.instances.find(i=>i._id===instanceId):null;setInstance(found||null);}catch(err){console.error('Error cargando detalle:',err);setError('Error cargando detalle de la plantilla');}finally{setLoading(false);}};fetchDetail();},[instance,instanceId]);if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando detalle\\u2026\"});if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error});if(!instance)return/*#__PURE__*/_jsx(\"p\",{children:\"No se encontr\\xF3 la plantilla asignada.\"});const{template,completedActivities}=instance;return/*#__PURE__*/_jsx(\"div\",{className:\"routine-templates-page patient-templates-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-container\",children:[/*#__PURE__*/_jsxs(Link,{to:\"/patient/templates\",className:\"back-btn\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-arrow-left\"}),\" Volver\"]}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Detalle de: \",template.name]}),/*#__PURE__*/_jsx(\"p\",{className:\"tpl-desc\",children:template.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-meta\",children:[\"Duraci\\xF3n: \",template.duration,\" min | Tags: \",(_template$tags=template.tags)===null||_template$tags===void 0?void 0:_template$tags.join(', ')]}),/*#__PURE__*/_jsx(\"ul\",{className:\"tpl-activities-list\",children:template.activities.map((act,idx)=>{const completed=completedActivities.includes(idx);return/*#__PURE__*/_jsxs(\"li\",{className:\"activity-item\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:completed,readOnly:true}),/*#__PURE__*/_jsxs(\"span\",{className:completed?'completed':'',children:[act.name,\" \\u2013 Nivel \",act.challenge,\" \\u2013 \",act.minutes,\" min\"]})]}),act.desc&&/*#__PURE__*/_jsx(\"p\",{className:\"activity-desc\",children:act.desc})]},idx);})})]})});}","map":{"version":3,"names":["React","useState","useEffect","useParams","Link","useLocation","axios","jsx","_jsx","jsxs","_jsxs","decodeJwt","token","b64Url","split","b64","replace","json","atob","JSON","parse","getPatientId","raw","localStorage","getItem","startsWith","slice","payload","_payload$user","id","sub","user","PatientTemplateDetail","_location$state","_template$tags","instanceId","location","instance","setInstance","state","loading","setLoading","error","setError","fetchDetail","patientId","res","get","headers","found","Array","isArray","data","find","i","_id","instances","err","console","children","className","template","completedActivities","to","name","description","duration","tags","join","activities","map","act","idx","completed","includes","type","checked","readOnly","challenge","minutes","desc"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesDetail.js"],"sourcesContent":["// src/components/PatientTemplateDetail.js\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useParams, Link, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport '../styles/routineTemplates.css';\r\n\r\n/**\r\n * Decodifica un JWT y devuelve su payload como objeto,\r\n * o null si falla.\r\n */\r\nfunction decodeJwt(token) {\r\n  try {\r\n    const b64Url = token.split('.')[1];\r\n    const b64    = b64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n    const json   = atob(b64);\r\n    return JSON.parse(json);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Obtiene el patientId de:\r\n * 1) payload del JWT (id, sub o user.id),\r\n * 2) fallback a localStorage.userId si lo guardas en login.\r\n */\r\nfunction getPatientId() {\r\n  const raw = localStorage.getItem('token') || '';\r\n  const token = raw.startsWith('Bearer ') ? raw.slice(7) : raw;\r\n  const payload = decodeJwt(token);\r\n  if (payload) {\r\n    return payload.id || payload.sub || payload.user?.id || null;\r\n  }\r\n  return localStorage.getItem('userId');\r\n}\r\n\r\nexport default function PatientTemplateDetail() {\r\n  const { instanceId } = useParams();\r\n  const location = useLocation();\r\n  const [instance, setInstance] = useState(location.state?.instance || null);\r\n  const [loading, setLoading]   = useState(!instance);\r\n  const [error, setError]       = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (instance) return;\r\n\r\n    const fetchDetail = async () => {\r\n      const token = localStorage.getItem('token');\r\n      const patientId = getPatientId();\r\n      if (!token || !patientId) {\r\n        setError('No estás autenticado. Por favor, inicia sesión.');\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // Traemos todas las instancias de este paciente\r\n        const res = await axios.get(\r\n          `/api/routines/instances/${patientId}`,\r\n          { headers: { 'x-auth-token': token } }\r\n        );\r\n        // Buscamos la que coincide con instanceId\r\n        const found = Array.isArray(res.data)\r\n          ? res.data.find(i => i._id === instanceId)\r\n          : (Array.isArray(res.data.instances)\r\n              ? res.data.instances.find(i => i._id === instanceId)\r\n              : null);\r\n        setInstance(found || null);\r\n      } catch (err) {\r\n        console.error('Error cargando detalle:', err);\r\n        setError('Error cargando detalle de la plantilla');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchDetail();\r\n  }, [instance, instanceId]);\r\n\r\n  if (loading) return <p>Cargando detalle…</p>;\r\n  if (error)   return <p className=\"error-msg\">{error}</p>;\r\n  if (!instance) return <p>No se encontró la plantilla asignada.</p>;\r\n\r\n  const { template, completedActivities } = instance;\r\n\r\n  return (\r\n    <div className=\"routine-templates-page patient-templates-page\">\r\n      <div className=\"tpl-container\">\r\n        <Link to=\"/patient/templates\" className=\"back-btn\">\r\n          <i className=\"fa fa-arrow-left\"></i> Volver\r\n        </Link>\r\n\r\n        <h1>Detalle de: {template.name}</h1>\r\n        <p className=\"tpl-desc\">{template.description}</p>\r\n        <div className=\"tpl-meta\">\r\n          Duración: {template.duration} min | Tags: {template.tags?.join(', ')}\r\n        </div>\r\n\r\n        <ul className=\"tpl-activities-list\">\r\n          {template.activities.map((act, idx) => {\r\n            const completed = completedActivities.includes(idx);\r\n            return (\r\n              <li key={idx} className=\"activity-item\">\r\n                <label>\r\n                  <input type=\"checkbox\" checked={completed} readOnly />\r\n                  <span className={completed ? 'completed' : ''}>\r\n                    {act.name} – Nivel {act.challenge} – {act.minutes} min\r\n                  </span>\r\n                </label>\r\n                {act.desc && <p className=\"activity-desc\">{act.desc}</p>}\r\n              </li>\r\n            );\r\n          })}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}