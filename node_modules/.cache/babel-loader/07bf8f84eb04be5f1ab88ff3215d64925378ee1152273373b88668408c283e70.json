{"ast":null,"code":"import React,{useEffect,useState}from'react';import authService from'../services/authService';import'../styles/routineTemplates.css';// aseg√∫rate de que √©sta es la ruta correcta\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function PatientTemplates(){const[templates,setTemplates]=useState([]);const[filterTag,setFilterTag]=useState('');const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchAssigned=async()=>{try{const user=authService.getCurrentUser();const res=await fetch(`/api/routineInstances?patientId=${user.id}`);if(!res.ok)throw new Error('Error al cargar plantillas');const data=await res.json();setTemplates(data);}catch(err){setError(err.message);}finally{setLoading(false);}};fetchAssigned();},[]);const toggleCompleted=async(instId,actId)=>{try{await fetch(`/api/routineInstances/${instId}/activities/${actId}/toggle`,{method:'PATCH'});setTemplates(ts=>ts.map(t=>t.id!==instId?t:{...t,activities:t.activities.map(a=>a.id!==actId?a:{...a,completed:!a.completed})}));}catch(e){console.error(e);}};const handleDurationChange=(instId,actId,val)=>{setTemplates(ts=>ts.map(t=>t.id!==instId?t:{...t,activities:t.activities.map(a=>a.id!==actId?a:{...a,duration:val})}));};const saveChanges=async instId=>{const tpl=templates.find(t=>t.id===instId);try{await fetch(`/api/routineInstances/${instId}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({activities:tpl.activities})});alert('Cambios guardados üëç');}catch{alert('Error guardando');}};const filtered=templates.filter(t=>filterTag?t.tags.includes(filterTag):true);return/*#__PURE__*/_jsx(\"div\",{className:\"routine-templates-page patient-templates-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Mis Plantillas Asignadas\"}),/*#__PURE__*/_jsx(\"div\",{className:\"tag-input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Filtrar por etiqueta\",value:filterTag,onChange:e=>setFilterTag(e.target.value),className:\"small-input\"})})]}),loading&&/*#__PURE__*/_jsx(\"p\",{children:\"Cargando plantillas\\u2026\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-msg\",children:error}),!loading&&!error&&/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-grid\",children:[filtered.map(tpl=>/*#__PURE__*/_jsxs(\"div\",{className:\"tpl-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:tpl.title}),/*#__PURE__*/_jsx(\"p\",{className:\"tpl-desc\",children:tpl.description}),/*#__PURE__*/_jsxs(\"p\",{className:\"tpl-meta\",children:[\"Asignado el: \",new Date(tpl.assignedAt).toLocaleDateString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"challenge-indicator\",\"data-level\":tpl.challengeLevel,children:tpl.challengeLevel}),/*#__PURE__*/_jsx(\"ul\",{className:\"tpl-activities-list\",children:tpl.activities.map(act=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"div\",{className:`activity-item ${act.completed?'status-completed':''}`,children:[/*#__PURE__*/_jsx(\"span\",{className:\"drag-handle\",children:\"\\u2261\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"activity-content\",children:[/*#__PURE__*/_jsx(\"h3\",{children:act.title}),/*#__PURE__*/_jsx(\"p\",{children:act.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:act.duration,onChange:e=>handleDurationChange(tpl.id,act.id,e.target.value),className:\"small-input\"}),/*#__PURE__*/_jsxs(\"select\",{value:act.category,onChange:e=>{/* si quisieras editar categor√≠a, aqu√≠ */},className:\"small-select\",children:[/*#__PURE__*/_jsx(\"option\",{children:\"Ejercicio\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Meditaci\\xF3n\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Lectura\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Otro\"})]})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"activity-toggle\",onClick:()=>toggleCompleted(tpl.id,act.id),children:act.completed?'‚úîÔ∏è':'‚óªÔ∏è'})]})},act.id))}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-save\",onClick:()=>saveChanges(tpl.id),children:\"Guardar Cambios\"})]},tpl.id)),filtered.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"No hay plantillas que coincidan.\"})]})]})});}export default PatientTemplates;","map":{"version":3,"names":["React","useEffect","useState","authService","jsx","_jsx","jsxs","_jsxs","PatientTemplates","templates","setTemplates","filterTag","setFilterTag","loading","setLoading","error","setError","fetchAssigned","user","getCurrentUser","res","fetch","id","ok","Error","data","json","err","message","toggleCompleted","instId","actId","method","ts","map","t","activities","a","completed","e","console","handleDurationChange","val","duration","saveChanges","tpl","find","headers","body","JSON","stringify","alert","filtered","filter","tags","includes","className","children","type","placeholder","value","onChange","target","title","description","Date","assignedAt","toLocaleDateString","challengeLevel","act","category","onClick","length"],"sources":["C:/Users/User/Desktop/TFG/prototipo-TFG/Janus-TFG/src/components/PatientTemplatesPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport authService from '../services/authService';\r\nimport '../styles/routineTemplates.css'; // aseg√∫rate de que √©sta es la ruta correcta\r\n\r\nfunction PatientTemplates() {\r\n  const [templates, setTemplates] = useState([]);\r\n  const [filterTag, setFilterTag] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchAssigned = async () => {\r\n      try {\r\n        const user = authService.getCurrentUser();\r\n        const res = await fetch(`/api/routineInstances?patientId=${user.id}`);\r\n        if (!res.ok) throw new Error('Error al cargar plantillas');\r\n        const data = await res.json();\r\n        setTemplates(data);\r\n      } catch (err) {\r\n        setError(err.message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchAssigned();\r\n  }, []);\r\n\r\n  const toggleCompleted = async (instId, actId) => {\r\n    try {\r\n      await fetch(`/api/routineInstances/${instId}/activities/${actId}/toggle`, {\r\n        method: 'PATCH'\r\n      });\r\n      setTemplates(ts =>\r\n        ts.map(t =>\r\n          t.id !== instId ? t : {\r\n            ...t,\r\n            activities: t.activities.map(a =>\r\n              a.id !== actId ? a : { ...a, completed: !a.completed }\r\n            )\r\n          }\r\n        )\r\n      );\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n  };\r\n\r\n  const handleDurationChange = (instId, actId, val) => {\r\n    setTemplates(ts =>\r\n      ts.map(t =>\r\n        t.id !== instId ? t : {\r\n          ...t,\r\n          activities: t.activities.map(a =>\r\n            a.id !== actId ? a : { ...a, duration: val }\r\n          )\r\n        }\r\n      )\r\n    );\r\n  };\r\n\r\n  const saveChanges = async instId => {\r\n    const tpl = templates.find(t => t.id === instId);\r\n    try {\r\n      await fetch(`/api/routineInstances/${instId}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ activities: tpl.activities })\r\n      });\r\n      alert('Cambios guardados üëç');\r\n    } catch {\r\n      alert('Error guardando');\r\n    }\r\n  };\r\n\r\n  const filtered = templates.filter(t =>\r\n    filterTag ? t.tags.includes(filterTag) : true\r\n  );\r\n\r\n  return (\r\n    <div className=\"routine-templates-page patient-templates-page\">\r\n      <div className=\"tpl-container\">\r\n        <div className=\"tpl-header\">\r\n          <h1>Mis Plantillas Asignadas</h1>\r\n          <div className=\"tag-input-group\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Filtrar por etiqueta\"\r\n              value={filterTag}\r\n              onChange={e => setFilterTag(e.target.value)}\r\n              className=\"small-input\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {loading && <p>Cargando plantillas‚Ä¶</p>}\r\n        {error   && <p className=\"error-msg\">{error}</p>}\r\n\r\n        {!loading && !error && (\r\n          <div className=\"tpl-grid\">\r\n            {filtered.map(tpl => (\r\n              <div key={tpl.id} className=\"tpl-card\">\r\n                <h2>{tpl.title}</h2>\r\n                <p className=\"tpl-desc\">{tpl.description}</p>\r\n                <p className=\"tpl-meta\">\r\n                  Asignado el: {new Date(tpl.assignedAt).toLocaleDateString()}\r\n                </p>\r\n                <div className=\"challenge-indicator\" data-level={tpl.challengeLevel}>\r\n                  {tpl.challengeLevel}\r\n                </div>\r\n\r\n                <ul className=\"tpl-activities-list\">\r\n                  {tpl.activities.map(act => (\r\n                    <li key={act.id}>\r\n                      <div className={`activity-item ${act.completed ? 'status-completed' : ''}`}>\r\n                        <span className=\"drag-handle\">‚â°</span>\r\n                        <div className=\"activity-content\">\r\n                          <h3>{act.title}</h3>\r\n                          <p>{act.description}</p>\r\n                          <div className=\"form-grid\">\r\n                            <input\r\n                              type=\"text\"\r\n                              value={act.duration}\r\n                              onChange={e => handleDurationChange(tpl.id, act.id, e.target.value)}\r\n                              className=\"small-input\"\r\n                            />\r\n                            <select\r\n                              value={act.category}\r\n                              onChange={e => {/* si quisieras editar categor√≠a, aqu√≠ */}}\r\n                              className=\"small-select\"\r\n                            >\r\n                              <option>Ejercicio</option>\r\n                              <option>Meditaci√≥n</option>\r\n                              <option>Lectura</option>\r\n                              <option>Otro</option>\r\n                            </select>\r\n                          </div>\r\n                        </div>\r\n                        <button\r\n                          className=\"activity-toggle\"\r\n                          onClick={() => toggleCompleted(tpl.id, act.id)}\r\n                        >\r\n                          {act.completed ? '‚úîÔ∏è' : '‚óªÔ∏è'}\r\n                        </button>\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n\r\n                <button className=\"btn-save\" onClick={() => saveChanges(tpl.id)}>\r\n                  Guardar Cambios\r\n                </button>\r\n              </div>\r\n            ))}\r\n\r\n            {filtered.length === 0 && <p>No hay plantillas que coincidan.</p>}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PatientTemplates;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}